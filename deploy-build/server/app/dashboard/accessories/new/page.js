(()=>{var e={};e.id=4905,e.ids=[4905],e.modules={16:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(23428),a=s(60687);let i=(0,t.A)((0,a.jsx)("path",{d:"M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12z"}),"Label")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11960:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>t});let t=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\siddh\\\\Documents\\\\tsuki-cms-2\\\\app\\\\dashboard\\\\accessories\\\\new\\\\page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\accessories\\new\\page.js","default")},11997:e=>{"use strict";e.exports=require("punycode")},16524:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(23428),a=s(60687);let i=(0,t.A)((0,a.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"}),"Description")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},38703:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(23428),a=s(60687);let i=(0,t.A)((0,a.jsx)("path",{d:"M12 13V9c0-.55-.45-1-1-1H7V6h5V4H9.5V3h-2v1H6c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h4v2H5v2h2.5v1h2v-1H11c.55 0 1-.45 1-1m7.59-.48-5.66 5.65-2.83-2.83-1.41 1.42L13.93 21 21 13.93z"}),"PriceCheck")},43596:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(23428),a=s(60687);let i=(0,t.A)((0,a.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link")},52495:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>o.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var t=s(65239),a=s(48088),i=s(88170),o=s.n(i),n=s(30893),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(r,l);let c={children:["",{children:["dashboard",{children:["accessories",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,11960)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\accessories\\new\\page.js"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,27577)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\layout.js"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,32648)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\accessories\\new\\page.js"],u={require:s,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/dashboard/accessories/new/page",pathname:"/dashboard/accessories/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},53694:(e,r,s)=>{Promise.resolve().then(s.bind(s,88095))},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},58422:(e,r,s)=>{Promise.resolve().then(s.bind(s,11960))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},84122:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(23428),a=s(60687);let i=(0,t.A)((0,a.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory")},88095:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>B});var t=s(60687),a=s(43210),i=s(89431),o=s(87088),n=s(66803),l=s(41434),c=s(2420),d=s(16189),u=s(25495),p=s(85126),h=s.n(p),m=s(21360),x=s(88931),g=s(16184),A=s(51067),b=s(25685),y=s(16393),j=s(51711),v=s(18811),f=s(91176),w=s(49205),C=s(23789),q=s(52260),P=s(41629),k=s(47651),I=s(9133),S=s(5294),T=s(16),_=s(43596),H=s(16524),$=s(84122),U=s(29041),D=s(102),V=s(77780),z=s(38703),E=s(71411),W=s(12064),M=s(37402),N=s(30476),L=s(85814),R=s.n(L),F=s(88920),G=s(26001);function O({categories:e}){let r=(0,c.U)(),s=(0,d.useRouter)(),i=(0,m.A)(),[p,L]=(0,a.useState)(""),[O,B]=(0,a.useState)(""),[K,Q]=(0,a.useState)(""),[X,J]=(0,a.useState)(""),[Y,Z]=(0,a.useState)(""),[ee,er]=(0,a.useState)(""),[es,et]=(0,a.useState)(""),[ea,ei]=(0,a.useState)([]),[eo,en]=(0,a.useState)(null),[el,ec]=(0,a.useState)(!1),[ed,eu]=(0,a.useState)(null),[ep,eh]=(0,a.useState)({}),[em,ex]=(0,a.useState)(!1),[eg,eA]=(0,a.useState)(0),eb=(0,a.useCallback)(e=>{if(e){let r=(0,u.A)().slice(0,8);B(h()(`${e}-${r}`,{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g}))}else B("")},[]),ey=()=>{let e={};return p.trim()||(e.name="Name is required."),O.trim()||(e.slug="Slug is required (auto-generated from name)."),X||(e.categoryId="Category is required."),es||(e.accessoryType="Accessory type is required."),(!Y||isNaN(parseFloat(Y))||0>=parseFloat(Y))&&(e.price="Valid price is required."),(!ee||isNaN(parseInt(ee))||0>parseInt(ee))&&(e.stock="Valid stock quantity is required."),0===ea.length&&(e.images="At least one image is required."),eo||(e.images=e.images?e.images+" Thumbnail generation failed or no image uploaded.":"Thumbnail generation failed or no image uploaded."),eh(e),0===Object.keys(e).length},ej=(0,a.useCallback)(({mainImageFiles:e,thumbnailImageFile:r})=>{console.log("[NewAccessoryForm] handleImageUploadComplete called. Data:",{mainFiles:e?.length,thumbFile:r?.name}),ei(e||[]),en(r),ep.images&&eh(e=>({...e,images:null}))},[ep.images]),ev=async e=>{if(e.preventDefault(),!ey())return void eu("Please correct the errors in the form.");ec(!0),eu(null);try{let e=null;if(eo){let s=new Date().toISOString().split("T")[0].replace(/-/g,"/"),t=`thumb_${(0,u.A)()}_${h()(eo.name,{lower:!0,strict:!0})}`,a=`accessories/${s}/${t}`,{data:i,error:o}=await r.storage.from("cardimages").upload(a,eo);if(o)throw Error(`Thumbnail upload failed: ${o.message}`);let{data:n}=r.storage.from("cardimages").getPublicUrl(a);e=n.publicUrl}else throw Error("Thumbnail is required.");let t=[];if(ea.length>0)for(let e of ea){let s=new Date().toISOString().split("T")[0].replace(/-/g,"/"),a=`${(0,u.A)()}_${h()(e.name,{lower:!0,strict:!0})}`,i=`accessories/${s}/${a}`,{error:o}=await r.storage.from("cardimages").upload(i,e);if(o)throw Error(`Image upload failed for ${e.name}: ${o.message}`);let{data:n}=r.storage.from("cardimages").getPublicUrl(i);t.push(n.publicUrl)}else throw Error("At least one main image is required.");let{error:a}=await r.from("accessories").insert({name:p,slug:O,description:K,category_id:X,accessory_type:es,price:parseFloat(Y),stock_quantity:parseInt(ee),image_urls:t,thumbnail_url:e});if(a)throw Error(`Database insert failed: ${a.message}`);L(""),B(""),Q(""),J(""),Z(""),er(""),et(""),ei([]),en(null),eA(e=>e+1),ex(!0),setTimeout(()=>{s.push("/dashboard/accessories")},1e3)}catch(e){console.error("Error submitting accessory:",e),eu(e.message||"An unexpected error occurred.")}finally{ec(!1)}};return(0,t.jsxs)(x.A,{sx:{maxWidth:800,mx:"auto",p:3},children:[(0,t.jsxs)(x.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,t.jsx)(o.A,{variant:"h4",component:"h1",sx:{fontWeight:700},children:"Add New Accessory"}),(0,t.jsx)(g.A,{component:R(),href:"/dashboard/accessories",variant:"outlined",startIcon:(0,t.jsx)(W.A,{}),sx:{borderRadius:2},children:"Back to Accessories"})]}),(0,t.jsx)(A.A,{elevation:0,sx:{borderRadius:2,overflow:"hidden"},children:(0,t.jsxs)(x.A,{component:"form",onSubmit:ev,sx:{p:3},children:[(0,t.jsxs)(F.N,{children:[ed&&(0,t.jsx)(G.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,t.jsx)(l.A,{severity:"error",sx:{mb:3},onClose:()=>eu(null),children:ed})}),em&&(0,t.jsx)(G.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,t.jsx)(l.A,{severity:"success",sx:{mb:3},onClose:()=>ex(!1),children:"Accessory created successfully! Redirecting..."})})]}),(0,t.jsxs)(x.A,{sx:{mb:4},children:[(0,t.jsxs)(o.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(V.A,{color:"primary"}),"Basic Information"]}),(0,t.jsxs)(b.A,{spacing:3,children:[(0,t.jsx)(y.A,{required:!0,fullWidth:!0,id:"name",label:"Accessory Name",name:"name",value:p,onChange:e=>{let r=e.target.value;L(r),eb(r)},error:!!ep.name,helperText:ep.name,disabled:el,InputProps:{startAdornment:(0,t.jsx)(j.A,{position:"start",children:(0,t.jsx)(T.A,{color:"action"})})}}),(0,t.jsx)(v.A,{title:"Auto-generated from name",arrow:!0,placement:"top",children:(0,t.jsx)(y.A,{fullWidth:!0,id:"slug",label:"Slug",name:"slug",value:O,InputProps:{readOnly:!0,startAdornment:(0,t.jsx)(j.A,{position:"start",children:(0,t.jsx)(_.A,{color:"action"})})},error:!!ep.slug,helperText:ep.slug,disabled:el,sx:{"& .MuiOutlinedInput-root":{bgcolor:"dark"===i.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)"}}})}),(0,t.jsx)(y.A,{fullWidth:!0,id:"description",label:"Description",name:"description",multiline:!0,rows:4,value:K,onChange:e=>Q(e.target.value),disabled:el,InputProps:{startAdornment:(0,t.jsx)(j.A,{position:"start",sx:{alignSelf:"flex-start",mt:1.5},children:(0,t.jsx)(H.A,{color:"action"})})}})]})]}),(0,t.jsx)(f.A,{sx:{my:4}}),(0,t.jsxs)(x.A,{sx:{mb:4},children:[(0,t.jsxs)(o.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(z.A,{color:"primary"}),"Classification & Pricing"]}),(0,t.jsxs)(b.A,{spacing:3,children:[(0,t.jsxs)(w.A,{container:!0,spacing:2,children:[(0,t.jsx)(w.A,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(C.A,{fullWidth:!0,required:!0,error:!!ep.categoryId,children:[(0,t.jsx)(q.A,{id:"category-label",children:"Category"}),(0,t.jsx)(P.A,{labelId:"category-label",id:"category",value:X,label:"Category",onChange:e=>J(e.target.value),disabled:el,children:e.map(e=>(0,t.jsx)(k.A,{value:e.id,children:e.name},e.id))}),ep.categoryId&&(0,t.jsx)(I.A,{children:ep.categoryId})]})}),(0,t.jsx)(w.A,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(C.A,{fullWidth:!0,required:!0,error:!!ep.accessoryType,children:[(0,t.jsx)(q.A,{id:"accessory-type-label",children:"Accessory Type"}),(0,t.jsx)(P.A,{labelId:"accessory-type-label",id:"accessoryType",value:es,label:"Accessory Type",onChange:e=>et(e.target.value),disabled:el,children:["Binder","Sleeve","Toploader","Grading Service","Storage Box","Display Case","Other"].map(e=>(0,t.jsx)(k.A,{value:e,children:e},e))}),ep.accessoryType&&(0,t.jsx)(I.A,{children:ep.accessoryType})]})})]}),(0,t.jsxs)(w.A,{container:!0,spacing:2,children:[(0,t.jsx)(w.A,{item:!0,xs:12,sm:6,children:(0,t.jsx)(y.A,{required:!0,fullWidth:!0,id:"price",label:"Price",name:"price",type:"number",inputProps:{min:0,step:.01},value:Y,onChange:e=>Z(e.target.value),error:!!ep.price,helperText:ep.price,disabled:el,InputProps:{startAdornment:(0,t.jsx)(j.A,{position:"start",children:(0,t.jsx)(M.A,{color:"action"})})}})}),(0,t.jsx)(w.A,{item:!0,xs:12,sm:6,children:(0,t.jsx)(y.A,{required:!0,fullWidth:!0,id:"stock",label:"Stock Quantity",name:"stock",type:"number",inputProps:{min:0,step:1},value:ee,onChange:e=>er(e.target.value),error:!!ep.stock,helperText:ep.stock,disabled:el,InputProps:{startAdornment:(0,t.jsx)(j.A,{position:"start",children:(0,t.jsx)($.A,{color:"action"})})}})})]})]})]}),(0,t.jsx)(f.A,{sx:{my:4}}),(0,t.jsxs)(x.A,{sx:{mb:4},children:[(0,t.jsxs)(o.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(E.A,{color:"primary"}),"Images & Thumbnail"]}),(0,t.jsx)(l.A,{severity:"info",sx:{mb:2},children:"Upload clear images of your accessory. At least one image and a thumbnail are required."}),(0,t.jsx)(x.A,{sx:{p:3,border:"1px dashed",borderColor:ep.images?i.palette.error.main:i.palette.divider,borderRadius:2,bgcolor:"dark"===i.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)",transition:"all 0.2s"},children:(0,t.jsx)(N.A,{bucketName:"cardimages",pathPrefix:"accessories",onUploadComplete:ej,resetKey:eg,targetHeight:320,targetWidth:240})}),ea.length>0&&(0,t.jsx)(S.A,{in:!0,children:(0,t.jsxs)(l.A,{severity:"success",sx:{mt:2},icon:(0,t.jsx)(D.A,{}),children:[ea.length," image(s) ready.",eo?" Thumbnail is set.":' Please select a thumbnail using the "Make Thumb" button.']})}),ep.images&&(0,t.jsx)(I.A,{error:!0,sx:{ml:2,mt:.5},children:ep.images})]}),(0,t.jsx)(f.A,{sx:{my:3}}),(0,t.jsxs)(b.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,t.jsx)(g.A,{variant:"outlined",onClick:()=>window.history.back(),disabled:el,children:"Cancel"}),(0,t.jsx)(g.A,{type:"submit",variant:"contained",disabled:el,startIcon:el?(0,t.jsx)(n.A,{size:20}):(0,t.jsx)(U.A,{}),sx:{minWidth:200,background:el?void 0:`linear-gradient(45deg, ${i.palette.primary.main} 30%, ${i.palette.secondary.main} 90%)`},children:el?"Adding Accessory...":"Add Accessory to Collection"})]})]})})]})}function B(){let[e,r]=(0,a.useState)([]),[s,d]=(0,a.useState)(!0),[u,p]=(0,a.useState)(null),h=(0,c.U)();return(0,a.useCallback)(async()=>{d(!0),p(null);try{let{data:e,error:s}=await h.from("categories").select("id, name").order("name",{ascending:!0});if(s)throw s;r(e||[])}catch(e){console.error("Error fetching categories:",e),p("Failed to load categories. Please try again.")}finally{d(!1)}},[h]),(0,t.jsxs)(i.A,{maxWidth:"md",children:[(0,t.jsx)(o.A,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mt:4,mb:4},children:"Add New Accessory"}),s&&(0,t.jsx)(n.A,{}),u&&(0,t.jsx)(l.A,{severity:"error",sx:{mb:2},children:u}),!s&&!u&&(0,t.jsx)(O,{categories:e})]})}},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4447,1103,1658,4468,2153,4112,8164,8102,6393,9205,5814,8743,8811,8064,3156,476],()=>s(52495));module.exports=t})();