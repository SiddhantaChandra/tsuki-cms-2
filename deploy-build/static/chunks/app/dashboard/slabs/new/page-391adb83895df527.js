(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5910],{10005:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(57515),r=a(95155);let i=(0,s.A)((0,r.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Grade")},35008:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>V});var s=a(95155),r=a(12115),i=a(16324),l=a(67217),n=a(54581),o=a(10431),d=a(700),c=a(68534),u=a(41218),x=a(4420),m=a(16632),h=a(6874),g=a.n(h),p=a(35695),f=a(55954),j=a(14426),A=a(92302),b=a(18407),y=a(71803),S=a(78449),v=a(33989),C=a(72110),w=a(27088),_=a(17348),q=a(68104),I=a(76380),E=a(74964),D=a(14962),P=a(15760),k=a(51368),F=a(96262),N=a.n(F),W=a(60760),G=a(76408),L=a(80946),T=a(88806),U=a(46108),z=a(91058),M=a(38464),O=a(51935),R=a(57773),B=a(71820),J=a(52671),H=a(10005);function Y(e){let{initialCategories:t,loadingCategoriesExternal:a,categoryErrorExternal:l,onFormSubmitSuccess:o}=e,u=(0,f.U)(),x=(0,i.A)(),[m,h]=(0,r.useState)(""),[p,F]=(0,r.useState)(""),[Y,X]=(0,r.useState)(""),[K,Q]=(0,r.useState)(""),[V,Z]=(0,r.useState)(""),[$,ee]=(0,r.useState)(""),[et,ea]=(0,r.useState)("perfect"),[es,er]=(0,r.useState)("Japanese"),[ei,el]=(0,r.useState)(""),[en,eo]=(0,r.useState)(t||[]),[ed,ec]=(0,r.useState)([]),[eu,ex]=(0,r.useState)([]),[em,eh]=(0,r.useState)([]),[eg,ep]=(0,r.useState)([]),[ef,ej]=(0,r.useState)(!1),[eA,eb]=(0,r.useState)(!1),[ey,eS]=(0,r.useState)(!0),[ev,eC]=(0,r.useState)(!1),[ew,e_]=(0,r.useState)(null),[eq,eI]=(0,r.useState)(null),[eE,eD]=(0,r.useState)([]),[eP,ek]=(0,r.useState)(null),eF=(0,r.useRef)(null);(0,r.useEffect)(()=>{eo(t||[])},[t]),(0,r.useEffect)(()=>{(async()=>{eS(!0);let{data:e,error:t}=await u.from("grade_companies").select("id, name, grades");t?(e_("Failed to load grading companies: "+t.message),eh([])):eh(e||[]),eS(!1)})()},[u]),(0,r.useEffect)(()=>{p?(async()=>{ej(!0),ec([]),X(""),ex([]),Q("");let{data:e,error:t}=await u.from("sets").select("id, name").eq("category_id",p);t?e_("Failed to load sets: "+t.message):ec(e||[]),ej(!1)})():(ec([]),X(""),ex([]),Q(""))},[p,u]),(0,r.useEffect)(()=>{Y?(async()=>{if(Y)try{eb(!0),ex([]),Q("");let{data:e,error:t}=await u.from("subsets").select("id, name, slug, release_date").eq("set_id",Y);if(t)throw t;if(e){let t=[...e].sort((e,t)=>e.release_date&&t.release_date?new Date(t.release_date)-new Date(e.release_date):e.release_date?-1:1*!!t.release_date);ex(t)}}catch(e){console.error("Error fetching subsets:",e.message)}finally{eb(!1)}})():(ex([]),Q(""))},[Y,u]),(0,r.useEffect)(()=>{if(V){let e=em.find(e=>e.id===V);ep(e&&e.grades||[]),ee("")}else ep([]),ee("")},[V,em]);let eN=async e=>{if(e.preventDefault(),eC(!0),e_(null),eI(null),!m.trim()){e_("Slab Name is required."),eC(!1);return}if(0===eE.length){e_("At least one slab image is required."),eC(!1);return}if(!eP){e_('Thumbnail is required. Please use the "Make Thumb" button on one of the images.'),eC(!1);return}if(!p){e_("Category is required."),eC(!1);return}if(!Y){e_("Set is required."),eC(!1);return}if(!K){e_("Subset is required."),eC(!1);return}if(!V){e_("Grading Company is required."),eC(!1);return}if(!$){e_("Grade Score is required."),eC(!1);return}if(!et.trim()){e_("Condition is required."),eC(!1);return}if(!es.trim()){e_("Language is required."),eC(!1);return}let t=parseFloat(ei);if(isNaN(t)||t<=0){e_("Price must be a positive number."),eC(!1);return}if(l){e_("Cannot submit, categories failed to load on parent page."),eC(!1);return}try{let e=m.trim(),a=N()(e,{lower:!0,strict:!0,remove:/[*+~.()\'\"!:@]/g}),s=(0,k.A)().substring(0,8),r="".concat(a,"-").concat(s),i=[],l=null;for(let e of eE){e.name.substring(0,e.name.lastIndexOf(".")||e.name.length);let t=new Date,a=t.getFullYear(),s=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getDate().toString().padStart(2,"0"),l="slabs/".concat(a,"/").concat(s,"/").concat(r,"/").concat((0,k.A)(),".webp"),{error:n}=await u.storage.from("slabimages").upload(l,e,{contentType:e.type,upsert:!1});if(n)throw Error("Failed to upload main image "+e.name+": "+n.message);let{data:{publicUrl:o}}=u.storage.from("slabimages").getPublicUrl(l);i.push(o)}if(eP){eP.name.substring(0,eP.name.lastIndexOf(".")||eP.name.length);let e=new Date,t=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),r="slabs/".concat(t,"/").concat(a,"/").concat(s,"/").concat((0,k.A)(),"_thumb.webp"),{error:i}=await u.storage.from("slabimages").upload(r,eP,{contentType:eP.type,upsert:!1});if(i)throw Error("Failed to upload thumbnail "+eP.name+": "+i.message);let{data:{publicUrl:n}}=u.storage.from("slabimages").getPublicUrl(r);l=n}let n={name:e,slug:r,image_urls:i,thumbnail_url:l,category_id:p,set_id:Y,subset_id:K,grade_company_id:V,grade_score:parseFloat($),condition:et.trim(),language:es.trim(),price:t},{error:d}=await u.from("slabs").insert(n);if(d)throw Error("Failed to insert slab: "+d.message);eI("Slab added successfully!"),h(""),F(""),X(""),Q(""),Z(""),ee(""),ea("perfect"),er("Japanese"),el(""),eD([]),ek(null),eF.current&&eF.current.reset&&eF.current.reset(),o&&o()}catch(e){e_("Operation failed: "+e.message),console.error("Submit Error Details:",e)}finally{eC(!1)}};return a?(0,s.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,s.jsx)(j.A,{}),(0,s.jsx)(d.A,{sx:{mt:2},children:"Loading category data from parent..."})]}):l?(0,s.jsx)(A.A,{severity:"error",sx:{mb:3,mt:2},children:"string"==typeof l?l:"Error loading categories from parent."}):(0,s.jsxs)(n.A,{sx:{maxWidth:800,mx:"auto",p:3},children:[(0,s.jsxs)(n.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,s.jsx)(d.A,{variant:"h4",component:"h1",sx:{fontWeight:700},children:"Add New Slab"}),(0,s.jsx)(c.A,{component:g(),href:"/dashboard/slabs",variant:"outlined",startIcon:(0,s.jsx)(M.A,{}),sx:{borderRadius:2},children:"Back to Slabs"})]}),a&&(0,s.jsxs)(n.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,s.jsx)(j.A,{}),(0,s.jsx)(d.A,{sx:{mt:2},children:"Loading category data from parent..."})]}),l&&(0,s.jsx)(A.A,{severity:"error",sx:{mb:3,mt:2},children:"string"==typeof l?l:"Error loading categories from parent."}),!a&&!l&&(0,s.jsx)(b.A,{elevation:0,sx:{borderRadius:2,overflow:"hidden"},children:(0,s.jsxs)(n.A,{component:"form",onSubmit:eN,sx:{p:3},children:[(0,s.jsxs)(W.N,{children:[ew&&(0,s.jsx)(G.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,s.jsx)(A.A,{severity:"error",sx:{mb:3},onClose:()=>e_(null),children:ew})}),eq&&(0,s.jsx)(G.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,s.jsx)(A.A,{severity:"success",sx:{mb:3},onClose:()=>eI(null),children:eq})})]}),(0,s.jsxs)(n.A,{sx:{mb:4},children:[(0,s.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,s.jsx)(L.A,{color:"primary"}),"Basic Information"]}),(0,s.jsxs)(y.A,{spacing:3,children:[(0,s.jsx)(S.A,{fullWidth:!0,label:"Slab Name",value:m,onChange:e=>h(e.target.value),required:!0,InputProps:{startAdornment:(0,s.jsx)(v.A,{position:"start",children:(0,s.jsx)(R.A,{color:"action"})})}}),(0,s.jsxs)(C.A,{container:!0,spacing:2,children:[(0,s.jsx)(C.A,{item:!0,xs:12,sm:6,children:(0,s.jsx)(S.A,{fullWidth:!0,label:"Price",type:"number",value:ei,onChange:e=>el(e.target.value),InputProps:{inputProps:{min:0,step:"0.01"},startAdornment:(0,s.jsx)(v.A,{position:"start",children:(0,s.jsx)(z.A,{color:"action"})})},required:!0})}),(0,s.jsx)(C.A,{item:!0,xs:12,sm:6,children:(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,s.jsx)(_.A,{children:"Language"}),(0,s.jsxs)(q.A,{value:es,label:"Language",onChange:e=>er(e.target.value),startAdornment:(0,s.jsx)(v.A,{position:"start",children:(0,s.jsx)(B.A,{color:"action"})}),children:[(0,s.jsx)(I.A,{value:"Japanese",children:"Japanese"}),(0,s.jsx)(I.A,{value:"English",children:"English"})]})]})})]}),(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,s.jsx)(_.A,{children:"Condition"}),(0,s.jsxs)(q.A,{value:et,label:"Condition",onChange:e=>ea(e.target.value),children:[(0,s.jsx)(I.A,{value:"perfect",children:"Perfect"}),(0,s.jsx)(I.A,{value:"scratched",children:"Scratched"}),(0,s.jsx)(I.A,{value:"damaged",children:"Damaged"})]})]})]})]}),(0,s.jsx)(E.A,{sx:{my:4}}),(0,s.jsxs)(n.A,{sx:{mb:4},children:[(0,s.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,s.jsx)(H.A,{color:"primary"}),"Grading Information"]}),(0,s.jsxs)(y.A,{spacing:3,children:[(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:ey,children:[(0,s.jsx)(_.A,{children:"Grading Company"}),(0,s.jsxs)(q.A,{value:V,label:"Grading Company",onChange:e=>Z(e.target.value),children:[(0,s.jsx)(I.A,{value:"",children:(0,s.jsx)("em",{children:"Select Grading Company"})}),em.map(e=>(0,s.jsx)(I.A,{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!V||0===eg.length,children:[(0,s.jsx)(_.A,{children:"Grade Score"}),(0,s.jsxs)(q.A,{value:$,label:"Grade Score",onChange:e=>ee(e.target.value),children:[(0,s.jsx)(I.A,{value:"",children:(0,s.jsx)("em",{children:"Select Grade Score"})}),eg.map(e=>(0,s.jsx)(I.A,{value:e,children:e},e))]})]})]})]}),(0,s.jsx)(E.A,{sx:{my:4}}),(0,s.jsxs)(n.A,{sx:{mb:4},children:[(0,s.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,s.jsx)(T.A,{color:"primary"}),"Classification"]}),(0,s.jsxs)(y.A,{spacing:3,children:[(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,s.jsx)(_.A,{children:"Category"}),(0,s.jsxs)(q.A,{value:p,label:"Category",onChange:e=>F(e.target.value),children:[(0,s.jsx)(I.A,{value:"",children:(0,s.jsx)("em",{children:"Select Category"})}),en.map(e=>(0,s.jsx)(I.A,{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!p,children:[(0,s.jsx)(_.A,{children:"Set"}),(0,s.jsxs)(q.A,{value:Y,label:"Set",onChange:e=>X(e.target.value),children:[(0,s.jsx)(I.A,{value:"",children:(0,s.jsx)("em",{children:"Select Set"})}),ed.map(e=>(0,s.jsx)(I.A,{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!Y,children:[(0,s.jsx)(_.A,{children:"Subset"}),(0,s.jsxs)(q.A,{value:K,label:"Subset",onChange:e=>Q(e.target.value),children:[(0,s.jsx)(I.A,{value:"",children:(0,s.jsx)("em",{children:"Select Subset"})}),eu.map(e=>(0,s.jsxs)(I.A,{value:e.id,children:[e.name," - ",e.slug]},e.id))]})]})]})]}),(0,s.jsx)(E.A,{sx:{my:4}}),(0,s.jsxs)(n.A,{sx:{mb:4},children:[(0,s.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,s.jsx)(J.A,{color:"primary"}),"Images & Thumbnail"]}),(0,s.jsx)(A.A,{severity:"info",sx:{mb:2},children:"Upload clear images of your slab. At least one image and a thumbnail are required."}),(0,s.jsx)(P.A,{bucketName:"slabimages",pathPrefix:"slabs",onUploadComplete:e=>{let{mainImageFiles:t,thumbnailImageFile:a}=e;eD(t||[]),ek(a||null),console.log("Image upload complete:",{mainCount:(null==t?void 0:t.length)||0,hasThumbnail:!!a})},ref:eF}),eE.length>0&&(0,s.jsx)(D.A,{in:!0,children:(0,s.jsxs)(A.A,{severity:"success",sx:{mt:2},icon:(0,s.jsx)(U.A,{}),children:[eE.length," image(s) ready.",eP?" Thumbnail is set.":' Please select a thumbnail using the "Make Thumb" button.']})})]}),(0,s.jsx)(E.A,{sx:{my:3}}),(0,s.jsxs)(y.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,s.jsx)(c.A,{variant:"outlined",onClick:()=>window.history.back(),disabled:ev,children:"Cancel"}),(0,s.jsx)(c.A,{type:"submit",variant:"contained",disabled:ev,startIcon:ev?(0,s.jsx)(j.A,{size:20}):(0,s.jsx)(O.A,{}),sx:{minWidth:200,background:ev?void 0:"linear-gradient(45deg, ".concat(x.palette.primary.main," 30%, ").concat(x.palette.secondary.main," 90%)")},children:ev?"Adding Slab...":"Add Slab to Collection"})]})]})})]})}var X=a(25249),K=a(99125),Q=a(52511);function V(){let e=(0,p.useRouter)(),t=(0,f.U)(),a=(0,i.A)(),[h,j]=(0,r.useState)([]),[A,b]=(0,r.useState)(!0),[y,S]=(0,r.useState)(null);return(0,r.useEffect)(()=>{(async()=>{b(!0);let{data:e,error:a}=await t.from("categories").select("id, name");a?(console.error("Failed to load categories for form:",a),S("Failed to load categories. Please try refreshing."),j([])):j(e||[]),b(!1)})()},[t]),(0,s.jsxs)(l.A,{maxWidth:"lg",sx:{py:4},children:[(0,s.jsx)(n.A,{sx:{mb:3},children:(0,s.jsxs)(o.A,{"aria-label":"breadcrumb",children:[(0,s.jsxs)(g(),{href:"/dashboard",passHref:!0,style:{color:a.palette.text.primary,textDecoration:"none",display:"flex",alignItems:"center"},children:[(0,s.jsx)(K.A,{sx:{mr:.5},fontSize:"small"}),"Dashboard"]}),(0,s.jsxs)(g(),{href:"/dashboard/slabs",passHref:!0,style:{color:a.palette.text.primary,textDecoration:"none",display:"flex",alignItems:"center"},children:[(0,s.jsx)(Q.A,{sx:{mr:.5},fontSize:"small"}),"Slabs"]}),(0,s.jsxs)(d.A,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(X.A,{sx:{mr:.5},fontSize:"small"}),"Add New Slab"]})]})}),(0,s.jsxs)(n.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:3},children:[(0,s.jsx)(d.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Add New Slab"}),(0,s.jsx)(c.A,{startIcon:(0,s.jsx)(M.A,{}),variant:"outlined",onClick:()=>e.push("/dashboard/slabs"),sx:{mb:{xs:2,sm:0}},children:"Back to Collection"})]}),(0,s.jsx)(u.A,{elevation:3,sx:{overflow:"visible",borderRadius:2,boxShadow:e=>"0 8px 32px ".concat((0,x.X4)(e.palette.primary.main,.1))},children:(0,s.jsx)(m.A,{sx:{p:{xs:2,sm:3,md:4}},children:(0,s.jsx)(Y,{initialCategories:h,loadingCategoriesExternal:A,categoryErrorExternal:y,onFormSubmitSuccess:()=>{console.log("NewSlabForm submitted successfully from page")}})})})]})}},43893:(e,t,a)=>{Promise.resolve().then(a.bind(a,35008))}},e=>{var t=t=>e(e.s=t);e.O(0,[3627,1935,4127,5158,2842,9295,4801,8449,2110,6153,6874,2330,9186,4955,259,8441,1684,7358],()=>t(43893)),_N_E=e.O()}]);