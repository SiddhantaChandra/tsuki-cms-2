(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5264],{8175:(e,t,r)=>{Promise.resolve().then(r.bind(r,20437))},20437:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>$});var a=r(95155),s=r(12115),i=r(16324),n=r(67217),l=r(54581),o=r(10431),d=r(700),c=r(68534),u=r(41218),m=r(4420),h=r(16632),x=r(6874),g=r.n(x),A=r(35695),p=r(55954),f=r(14426),j=r(92302),b=r(18407),y=r(71803),v=r(78449),C=r(33989),S=r(72110),w=r(27088),F=r(17348),N=r(68104),q=r(76380),I=r(74964),E=r(14962),_=r(41101),P=r(15760),T=r(92683),M=r(51368),D=r(96262),k=r.n(D),W=r(76408),z=r(60760),U=r(80946),R=r(88806),B=r(46108);let L=(0,r(57515).A)((0,a.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"ErrorOutline");var O=r(91058),J=r(38464),G=r(51935),H=r(57773),X=r(71820),Y=r(52671);function K(e){let{initialCategories:t,onFormSubmitSuccess:r,loadingCategories:n,categoryError:o}=e;console.log("[NewCardForm] Function body execution (render start). LoadingCategories:",n,"CategoryError:",o);let u=(0,p.U)(),m=(0,i.A)(),{showToast:h}=(0,T.d)(),[x,A]=(0,s.useState)(""),[D,K]=(0,s.useState)(""),[Q,V]=(0,s.useState)(""),[Z,$]=(0,s.useState)(""),[ee,et]=(0,s.useState)(""),[er,ea]=(0,s.useState)("10"),[es,ei]=(0,s.useState)("Japanese"),[en,el]=(0,s.useState)(t||[]),[eo,ed]=(0,s.useState)([]),[ec,eu]=(0,s.useState)([]),[em,eh]=(0,s.useState)(!1),[ex,eg]=(0,s.useState)(null),[eA,ep]=(0,s.useState)(null),[ef,ej]=(0,s.useState)(0),[eb,ey]=(0,s.useState)([]),[ev,eC]=(0,s.useState)(null),eS=(0,s.useRef)(!0),ew=(0,s.useRef)(0);(0,s.useRef)(null),ew.current+=1,(0,s.useEffect)(()=>(eS.current&&(console.log("[NewCardForm] Mounted. Render count: ".concat(ew.current)),eS.current=!1),()=>{console.log("[NewCardForm] Unmounting. Final render count: ".concat(ew.current,"."))}),[]),(0,s.useEffect)(()=>{console.log("[NewCardForm] initialCategories prop changed:",t),el(t||[]),(t||[]).length>0&&console.log("[NewCardForm] Categories updated from prop. Current selectedCategory:",D)},[t]),(0,s.useEffect)(()=>{D?(async()=>{ed([]),V(""),eu([]),$("");let{data:e,error:t}=await u.from("sets").select("id, name").eq("category_id",D);t?eg("Failed to load sets: "+t.message):ed(e||[])})():(ed([]),V(""),eu([]),$(""))},[D,u]),(0,s.useEffect)(()=>{Q?(async()=>{eu([]),$("");let{data:e,error:t}=await u.from("subsets").select("id, name, slug, release_date").eq("set_id",Q);t?eg("Failed to load subsets: "+t.message):eu([...e||[]].sort((e,t)=>e.release_date&&t.release_date?new Date(t.release_date)-new Date(e.release_date):e.release_date?-1:1*!!t.release_date))})():(eu([]),$(""))},[Q,u]),(0,s.useEffect)(()=>{eS.current||console.log("[NewCardForm] useEffect for image states: uploadedMainImageFiles count:",eb.length,"uploadedThumbnailFile:",ev?ev.name:null)},[eb,ev]);let eF=async e=>{if(e.preventDefault(),eh(!0),eg(null),ep(null),!x.trim()){eg("Card Name is required."),h("Card Name is required.",{severity:"error"}),eh(!1);return}if(0===eb.length){eg("At least one card image is required."),h("At least one card image is required.",{severity:"error"}),eh(!1);return}if(!ev){eg('Thumbnail is required. Please use the "Make Thumb" button on one of the images.'),h("Thumbnail is required.",{severity:"error"}),eh(!1);return}if(!D){eg("Category is required."),h("Category is required.",{severity:"error"}),eh(!1);return}if(!Q){eg("Set is required."),h("Set is required.",{severity:"error"}),eh(!1);return}if(!Z){eg("Subset is required."),h("Subset is required.",{severity:"error"}),eh(!1);return}if(!er.trim()){eg("Condition is required."),h("Condition is required.",{severity:"error"}),eh(!1);return}if(!es.trim()){eg("Language is required."),h("Language is required.",{severity:"error"}),eh(!1);return}let t=parseFloat(ee);if(isNaN(t)||t<=0){eg("Price must be a positive number."),h("Price must be a positive number.",{severity:"error"}),eh(!1);return}if(o){eg("Cannot submit, categories failed to load."),h("Cannot submit, categories failed to load.",{severity:"error"}),eh(!1);return}try{let e=x.trim(),t=k()(e,{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g}),a=(0,M.A)().substring(0,8),s="".concat(t,"-").concat(a),i=[],n=null;for(let e of eb){e.name.substring(0,e.name.lastIndexOf(".")||e.name.length);let t=new Date,r=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),n="cards/".concat(r,"/").concat(a,"/").concat(s,"/").concat((0,M.A)(),".webp"),{error:l}=await u.storage.from("cardimages").upload(n,e,{contentType:e.type,upsert:!1});if(l)throw Error("Failed to upload main image ".concat(e.name,": ").concat(l.message));let{data:{publicUrl:o}}=u.storage.from("cardimages").getPublicUrl(n);i.push(o)}if(ev){ev.name.substring(0,ev.name.lastIndexOf(".")||ev.name.length);let e=new Date,t=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0"),s="cards/".concat(t,"/").concat(r,"/").concat(a,"/").concat((0,M.A)(),"_thumb.webp"),{error:i}=await u.storage.from("cardimages").upload(s,ev,{contentType:ev.type,upsert:!1});if(i)throw Error("Failed to upload thumbnail ".concat(ev.name,": ").concat(i.message));let{data:{publicUrl:l}}=u.storage.from("cardimages").getPublicUrl(s);n=l}let l={name:e,slug:s,image_urls:i,thumbnail_url:n,category_id:D,set_id:Q||null,subset_id:Z||null,price:parseFloat(ee)||null,condition:er.trim()||null,language:es.trim()||null};console.log("Inserting card data:",l);let{error:o}=await u.from("cards").insert(l);if(o)throw Error("Failed to insert card: ".concat(o.message));h("Card added successfully!",{severity:"success",title:"Success"}),A(""),K(""),V(""),$(""),et(""),ea(""),ei(""),ey([]),eC(null),ej(e=>e+1),ep("Card added successfully!"),r&&r()}catch(t){let e="Operation failed: ".concat(t.message);eg(e),h(e,{severity:"error",title:"Error"}),console.error("Submit Error Details:",t)}finally{eh(!1)}};return(console.log("[NewCardForm] Returning JSX. Current state snapshot just before render:",{uploadedMainImageFilesCount:eb.length,uploadedThumbnailFileName:null==ev?void 0:ev.name}),n)?(0,a.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,a.jsx)(f.A,{}),(0,a.jsx)(d.A,{sx:{mt:2},children:"Loading form data..."})]}):o?(0,a.jsx)(j.A,{severity:"error",sx:{mb:3,mt:2},icon:(0,a.jsx)(L,{fontSize:"large"}),children:"string"==typeof o?o:"An error occurred while loading essential data for the form."}):(0,a.jsxs)(l.A,{sx:{maxWidth:800,mx:"auto",p:3},children:[(0,a.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,a.jsx)(d.A,{variant:"h4",component:"h1",sx:{fontWeight:700},children:"Add New Card"}),(0,a.jsx)(c.A,{component:g(),href:"/dashboard/cards",variant:"outlined",startIcon:(0,a.jsx)(J.A,{}),sx:{borderRadius:2},children:"Back to Collection"})]}),n&&(0,a.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,a.jsx)(f.A,{}),(0,a.jsx)(d.A,{sx:{mt:2},children:"Loading form data..."})]}),o&&(0,a.jsx)(j.A,{severity:"error",sx:{mb:3,mt:2},icon:(0,a.jsx)(L,{fontSize:"large"}),children:"string"==typeof o?o:"An error occurred while loading essential data for the form."}),!n&&!o&&(0,a.jsx)(b.A,{elevation:0,sx:{borderRadius:2,overflow:"hidden"},children:(0,a.jsxs)(l.A,{component:"form",onSubmit:eF,sx:{p:3},children:[(0,a.jsxs)(z.N,{children:[ex&&(0,a.jsx)(W.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,a.jsx)(j.A,{severity:"error",sx:{mb:3},onClose:()=>eg(null),children:ex})}),eA&&(0,a.jsx)(W.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,a.jsx)(j.A,{severity:"success",sx:{mb:3},onClose:()=>ep(null),children:eA})})]}),(0,a.jsxs)(l.A,{sx:{mb:4},children:[(0,a.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(U.A,{color:"primary"}),"Basic Information"]}),(0,a.jsxs)(y.A,{spacing:3,children:[(0,a.jsx)(v.A,{fullWidth:!0,label:"Card Name",value:x,onChange:e=>A(e.target.value),required:!0,InputProps:{startAdornment:(0,a.jsx)(C.A,{position:"start",children:(0,a.jsx)(H.A,{color:"action"})})}}),(0,a.jsxs)(S.A,{container:!0,spacing:2,children:[(0,a.jsx)(S.A,{item:!0,xs:12,sm:6,children:(0,a.jsx)(v.A,{fullWidth:!0,label:"Price",type:"number",value:ee,onChange:e=>et(e.target.value),InputProps:{inputProps:{min:0,step:"0.01"},startAdornment:(0,a.jsx)(C.A,{position:"start",children:(0,a.jsx)(O.A,{color:"action"})})},required:!0})}),(0,a.jsx)(S.A,{item:!0,xs:12,sm:6,children:(0,a.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,a.jsx)(F.A,{children:"Language"}),(0,a.jsxs)(N.A,{value:es,label:"Language",onChange:e=>ei(e.target.value),startAdornment:(0,a.jsx)(C.A,{position:"start",children:(0,a.jsx)(X.A,{color:"action"})}),children:[(0,a.jsx)(q.A,{value:"Japanese",children:"Japanese"}),(0,a.jsx)(q.A,{value:"English",children:"English"})]})]})})]}),(0,a.jsxs)(l.A,{children:[(0,a.jsx)(d.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Condition"}),(0,a.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,a.jsx)(F.A,{children:"Condition"}),(0,a.jsxs)(N.A,{value:er,label:"Condition",onChange:e=>ea(e.target.value),children:[(0,a.jsx)(q.A,{value:"10",children:"Gem Mint"}),(0,a.jsx)(q.A,{value:"9",children:"Mint"}),(0,a.jsx)(q.A,{value:"8",children:"Near Mint"}),(0,a.jsx)(q.A,{value:"7",children:"Excellent"}),(0,a.jsx)(q.A,{value:"6",children:"Good"}),(0,a.jsx)(q.A,{value:"5",children:"Fair"}),(0,a.jsx)(q.A,{value:"4",children:"Poor"})]})]})]})]})]}),(0,a.jsx)(I.A,{sx:{my:4}}),(0,a.jsxs)(l.A,{sx:{mb:4},children:[(0,a.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(R.A,{color:"primary"}),"Classification"]}),(0,a.jsxs)(y.A,{spacing:3,children:[(0,a.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,a.jsx)(F.A,{children:"Category"}),(0,a.jsxs)(N.A,{value:D,label:"Category",onChange:e=>K(e.target.value),children:[(0,a.jsx)(q.A,{value:"",children:(0,a.jsx)("em",{children:"Select Category"})}),en.map(e=>(0,a.jsx)(q.A,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!D,children:[(0,a.jsx)(F.A,{children:"Set"}),(0,a.jsxs)(N.A,{value:Q,label:"Set",onChange:e=>V(e.target.value),children:[(0,a.jsx)(q.A,{value:"",children:(0,a.jsx)("em",{children:"Select Set"})}),eo.map(e=>(0,a.jsx)(q.A,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!Q,children:[(0,a.jsx)(F.A,{children:"Subset"}),(0,a.jsxs)(N.A,{value:Z,label:"Subset",onChange:e=>$(e.target.value),children:[(0,a.jsx)(q.A,{value:"",children:(0,a.jsx)("em",{children:"Select Subset"})}),ec.map(e=>(0,a.jsxs)(q.A,{value:e.id,children:[e.name," - ",e.slug]},e.id))]})]})]})]}),(0,a.jsx)(I.A,{sx:{my:4}}),(0,a.jsxs)(l.A,{sx:{mb:4},children:[(0,a.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(Y.A,{color:"primary"}),"Images & Thumbnail"]}),(0,a.jsx)(j.A,{severity:"info",sx:{mb:2},children:"Upload clear images of your card. At least one image and a thumbnail are required."}),(0,a.jsx)(P.A,{bucketName:"cardimages",pathPrefix:"cards",onUploadComplete:e=>{console.log("[NewCardForm] handleImageUploadComplete called. Data:",e);let{mainImageFiles:t,thumbnailImageFile:r}=e,a=t||[],s=r||null;console.log("[NewCardForm] Before set state in handleImageUploadComplete. Current main files count:",eb.length,"Current thumb:",null==ev?void 0:ev.name),ey(a),eC(s),console.log("[NewCardForm] After set state in handleImageUploadComplete. Attempted to set main files count:",a.length,"Attempted thumb:",null==s?void 0:s.name)},resetKey:ef}),eb.length>0&&(0,a.jsx)(E.A,{in:!0,children:(0,a.jsxs)(j.A,{severity:"success",sx:{mt:2},icon:(0,a.jsx)(B.A,{}),children:[eb.length," image(s) ready.",ev?" Thumbnail is set.":' Please select a thumbnail using the "Make Thumb" button.']})}),(0,a.jsxs)(y.A,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,sx:{mt:2},children:[(0,a.jsx)(_.A,{label:"Upload clear images",size:"small",variant:"outlined"}),(0,a.jsx)(_.A,{label:"Create thumbnail from best image",size:"small",variant:"outlined"}),(0,a.jsx)(_.A,{label:"Add multiple angles if available",size:"small",variant:"outlined"})]})]}),(0,a.jsx)(I.A,{sx:{my:3}}),(0,a.jsxs)(y.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,a.jsx)(c.A,{variant:"outlined",onClick:()=>window.history.back(),disabled:em,children:"Cancel"}),(0,a.jsx)(c.A,{type:"submit",variant:"contained",disabled:em,startIcon:em?(0,a.jsx)(f.A,{size:20}):(0,a.jsx)(G.A,{}),sx:{minWidth:200,background:em?void 0:"linear-gradient(45deg, ".concat(m.palette.primary.main," 30%, ").concat(m.palette.secondary.main," 90%)")},children:em?"Adding Card...":"Add Card to Collection"})]})]})})]})}(0,W.P)(u.A),(0,W.P)(l.A);var Q=r(25249),V=r(99125),Z=r(52511);function $(){let e=(0,A.useRouter)(),t=(0,p.U)(),r=(0,i.A)(),[x,f]=(0,s.useState)([]),[j,b]=(0,s.useState)(!0),[y,v]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{b(!0);let{data:e,error:r}=await t.from("categories").select("id, name");r?(console.error("Failed to load categories for form:",r),v("Failed to load categories. Please try refreshing."),f([])):f(e||[]),b(!1)})()},[t]),(0,a.jsxs)(n.A,{maxWidth:"lg",sx:{py:4},children:[(0,a.jsx)(l.A,{sx:{mb:3},children:(0,a.jsxs)(o.A,{"aria-label":"breadcrumb",children:[(0,a.jsxs)(g(),{href:"/dashboard",passHref:!0,style:{color:r.palette.text.primary,textDecoration:"none",display:"flex",alignItems:"center"},children:[(0,a.jsx)(V.A,{sx:{mr:.5},fontSize:"small"}),"Dashboard"]}),(0,a.jsxs)(g(),{href:"/dashboard/cards",passHref:!0,style:{color:r.palette.text.primary,textDecoration:"none",display:"flex",alignItems:"center"},children:[(0,a.jsx)(Z.A,{sx:{mr:.5},fontSize:"small"}),"Cards"]}),(0,a.jsxs)(d.A,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[(0,a.jsx)(Q.A,{sx:{mr:.5},fontSize:"small"}),"Add New Card"]})]})}),(0,a.jsxs)(l.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:3},children:[(0,a.jsx)(d.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Add New Card"}),(0,a.jsx)(c.A,{startIcon:(0,a.jsx)(J.A,{}),variant:"outlined",onClick:()=>e.push("/dashboard/cards"),sx:{mb:{xs:2,sm:0}},children:"Back to Collection"})]}),(0,a.jsx)(u.A,{elevation:3,sx:{overflow:"visible",borderRadius:2,boxShadow:e=>"0 8px 32px ".concat((0,m.X4)(e.palette.primary.main,.1))},children:(0,a.jsx)(h.A,{sx:{p:{xs:2,sm:3,md:4}},children:(0,a.jsx)(K,{initialCategories:x,loadingCategories:j,categoryError:y,onFormSubmitSuccess:()=>{console.log("NewCardForm submitted successfully from page")}})})})]})}},89880:(e,t,r)=>{"use strict";r.d(t,{A:()=>A});var a=r(12115),s=r(52596),i=r(17472),n=r(75955),l=r(40680),o=r(10186),d=r(700),c=r(55170),u=r(90870);function m(e){return(0,u.Ay)("MuiAlertTitle",e)}(0,c.A)("MuiAlertTitle",["root"]);var h=r(95155);let x=e=>{let{classes:t}=e;return(0,i.A)({root:["root"]},m,t)},g=(0,n.Ay)(d.A,{name:"MuiAlertTitle",slot:"Root"})((0,l.A)(e=>{let{theme:t}=e;return{fontWeight:t.typography.fontWeightMedium,marginTop:-2}})),A=a.forwardRef(function(e,t){let r=(0,o.b)({props:e,name:"MuiAlertTitle"}),{className:a,...i}=r,n=x(r);return(0,h.jsx)(g,{gutterBottom:!0,component:"div",ownerState:r,ref:t,className:(0,s.A)(n.root,a),...i})})},92683:(e,t,r)=>{"use strict";r.d(t,{ToastProvider:()=>d,d:()=>c});var a=r(95155),s=r(12115),i=r(35726),n=r(92302),l=r(89880);let o=(0,s.createContext)({showToast:()=>{},hideToast:()=>{}});function d(e){let{children:t}=e,[r,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(""),[m,h]=(0,s.useState)(""),[x,g]=(0,s.useState)("info"),[A,p]=(0,s.useState)(5e3),f=()=>{d(!1)},j=(e,t)=>{"clickaway"!==t&&f()};return(0,a.jsxs)(o.Provider,{value:{showToast:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{title:r,severity:a,duration:s}=t;u(e),r&&h(r),a&&g(a),s&&p(s),d(!0)},hideToast:f},children:[t,(0,a.jsx)(i.A,{open:r,autoHideDuration:A,onClose:j,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,a.jsxs)(n.A,{onClose:j,severity:x,variant:"filled",sx:{width:"100%"},children:[m&&(0,a.jsx)(l.A,{children:m}),c]})})]})}function c(){return(0,s.useContext)(o)}}},e=>{var t=t=>e(e.s=t);e.O(0,[3627,1935,4127,5158,2842,9295,4801,8449,2110,6153,6874,1101,2330,9186,5726,4955,259,8441,1684,7358],()=>t(8175)),_N_E=e.O()}]);