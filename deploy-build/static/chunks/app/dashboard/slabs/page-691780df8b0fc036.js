(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7971],{37857:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(57515),i=a(95155);let l=(0,r.A)((0,i.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh")},40510:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(57515),i=a(95155);let l=(0,r.A)((0,i.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download")},41540:(e,t,a)=>{"use strict";a.d(t,{ul:()=>l});let r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#eeeeee",r='<svg width="'.concat(e,'" height="').concat(t,'" viewBox="0 0 ').concat(e," ").concat(t,'" xmlns="http://www.w3.org/2000/svg"><rect width="').concat(e,'" height="').concat(t,'" fill="').concat(a,'"/></svg>');return"data:image/svg+xml;base64,".concat(btoa(r))},i=e=>{switch(e){case"thumbnail":return"50px";case"card":return"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw";case"gallery":return"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw";case"hero":return"100vw";default:return"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 25vw"}},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{type:t="thumbnail",quality:a=75,loading:l="lazy"}=e,s={quality:a,loading:l,placeholder:"blur",sizes:i(t)};switch(t){case"thumbnail":return{...s,width:50,height:70,blurDataURL:r(50,70),style:{objectFit:"contain",borderRadius:"4px",transition:"opacity 0.3s ease"}};case"card":return{...s,fill:!0,blurDataURL:r(300,200),style:{objectFit:"cover",borderRadius:"4px 4px 0 0",transition:"transform 0.3s ease, opacity 0.3s ease"}};case"gallery":return{...s,width:400,height:300,blurDataURL:r(400,300),style:{objectFit:"cover",borderRadius:"4px",transition:"opacity 0.3s ease"}};default:return{...s,width:200,height:200,blurDataURL:r(200,200),style:{objectFit:"contain",borderRadius:"4px",transition:"opacity 0.3s ease"}}}}},55954:(e,t,a)=>{"use strict";a.d(t,{U:()=>i});var r=a(81935);function i(){return(0,r.createBrowserClient)("https://zyqebttgsbkjarthknns.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5cWVidHRnc2JramFydGhrbm5zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgwNzkxNzcsImV4cCI6MjA2MzY1NTE3N30.o3K5QGPT-BL6y9iBnn4oaxkrD-Oed6mW3TALFk4vqJ8")}},59475:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ep});var r=a(95155),i=a(12115),l=a(18407),s=a(16324),n=a(67217),o=a(10431),c=a(700),d=a(4420),h=a(71803),x=a(41101),u=a(35297),m=a(3127),g=a(68534),p=a(78449),j=a(33989),A=a(26564),b=a(14962),v=a(74964),f=a(16950),y=a(97644),w=a(60744),C=a(54581),S=a(92302),k=a(72110),I=a(17775),z=a(24507),_=a(18987),R=a(27088),F=a(17348),D=a(68104),E=a(76380),N=a(82330),W=a(35726),P=a(6874),X=a.n(P),B=a(55954),M=a(44296),O=a(17976),L=a(56033),J=a(90404),U=a(64263),G=a(99776),T=a(56278),H=a(54492),V=a(99927),q=a(76871),Y=a(4915),Z=a(33613),Q=a(71977),K=a(66766),$=a(28890),ee=a(19505),et=a(41540);function ea(e){let{slabs:t,onSlabDeleted:a}=e,s=(0,B.U)(),[n,o]=(0,i.useState)(!1),[d,h]=(0,i.useState)(null),[x,u]=(0,i.useState)(!1),[m,p]=(0,i.useState)(!1),[j,A]=(0,i.useState)(null);if(!t||0===t.length)return(0,r.jsx)(c.A,{sx:{textAlign:"center",my:5},children:"No slabs found. Add some!"});let b=e=>{h(e),o(!0),A(null),p(!1)},v=()=>{o(!1),h(null),A(null)},f=async()=>{if(d){u(!0),A(null);try{if(!m){if(d.image_urls&&d.image_urls.length>0)for(let e of(console.log("Attempting to delete",d.image_urls.length,"images"),d.image_urls))try{let t=e.match(/\/storage\/v1\/object\/public\/slabimages\/(.*)/);if(t&&t[1]){let e=t[1];console.log("Extracted file path:",e);let{error:a}=await s.storage.from("slabimages").remove([e]);a&&console.error("Failed to delete image:",a)}}catch(e){console.error("Error processing image deletion:",e)}if(d.thumbnail_url)try{let e=d.thumbnail_url.match(/\/storage\/v1\/object\/public\/slabimages\/(.*)/);if(e&&e[1]){let t=e[1],{error:a}=await s.storage.from("slabimages").remove([t]);a&&console.error("Failed to delete thumbnail:",a)}}catch(e){console.error("Error processing thumbnail deletion:",e)}}let{error:e}=await s.from("slabs").delete().eq("id",d.id);if(e)throw e;o(!1),a&&a(d.id)}catch(e){console.error("Error deleting slab:",e),A(e)}finally{u(!1)}}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(M.A,{component:l.A,children:(0,r.jsxs)(O.A,{sx:{minWidth:650},"aria-label":"slabs table",children:[(0,r.jsx)(L.A,{children:(0,r.jsxs)(J.A,{children:[(0,r.jsx)(U.A,{sx:{width:"100px"},children:"Image"}),(0,r.jsx)(U.A,{children:"Name"}),(0,r.jsx)(U.A,{children:"Grading Company"}),(0,r.jsx)(U.A,{children:"Grade"}),(0,r.jsx)(U.A,{align:"right",children:"Price"}),(0,r.jsx)(U.A,{align:"center",children:"Actions"})]})}),(0,r.jsx)(G.A,{children:t.map(e=>{var t;let a=e.thumbnail_url;return!a&&e.image_urls&&e.image_urls.length>0&&(a=e.image_urls[0]),(0,r.jsxs)(J.A,{children:[(0,r.jsx)(U.A,{component:"th",scope:"row",children:a?(0,r.jsx)(K.default,{src:a,alt:e.name||"Slab image",...(0,et.ul)({type:"thumbnail"})}):(0,r.jsx)(C.A,{sx:{width:50,height:70,backgroundColor:"grey.200",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px"},children:(0,r.jsx)(c.A,{variant:"caption",color:"textSecondary",children:"No Image"})})}),(0,r.jsx)(U.A,{children:e.name}),(0,r.jsx)(U.A,{children:(null==(t=e.grade_companies)?void 0:t.name)||"Unknown"}),(0,r.jsx)(U.A,{children:e.grade_score}),(0,r.jsx)(U.A,{align:"right",children:null!==e.price&&void 0!==e.price?"₹".concat(parseFloat(e.price).toFixed(2)):"N/A"}),(0,r.jsx)(U.A,{align:"center",children:(0,r.jsxs)(C.A,{sx:{display:"flex",justifyContent:"center",gap:1},children:[(0,r.jsx)(g.A,{component:X(),href:"/dashboard/slabs/".concat(e.id,"/edit"),size:"small",variant:"outlined",color:"primary",startIcon:(0,r.jsx)($.A,{}),children:"Edit"}),(0,r.jsx)(g.A,{size:"small",variant:"outlined",color:"error",startIcon:(0,r.jsx)(ee.A,{}),onClick:()=>b(e),children:"Delete"})]})})]},e.id)})})]})}),(0,r.jsxs)(T.A,{open:n,onClose:v,"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[(0,r.jsx)(H.A,{id:"delete-dialog-title",children:"Confirm Delete"}),(0,r.jsxs)(V.A,{children:[(0,r.jsxs)(q.A,{id:"delete-dialog-description",children:['Are you sure you want to delete the slab "',null==d?void 0:d.name,'"? This action cannot be undone and will remove all associated images from storage.']}),j&&(0,r.jsxs)(c.A,{color:"error",sx:{mt:2},children:["Error: ",j.message||"Failed to delete slab"]}),(0,r.jsx)(Y.A,{control:(0,r.jsx)(Z.A,{checked:m,onChange:e=>p(e.target.checked)}),label:"Force delete (skip image deletion)",sx:{mt:2,color:"error.main"}})]}),(0,r.jsxs)(Q.A,{children:[(0,r.jsx)(g.A,{onClick:v,disabled:x,children:"Cancel"}),(0,r.jsx)(g.A,{onClick:f,color:"error",disabled:x,autoFocus:!0,children:x?"Deleting...":"Delete"})]})]})]})}var er=a(40857),ei=a(63954),el=a(40510),es=a(37857),en=a(95679),eo=a(48771),ec=a(91640),ed=a(99125),eh=a(52511),ex=a(74863),eu=a(76408),em=a(60760);let eg=(0,eu.P)(l.A);function ep(){var e;let t=(0,B.U)(),a=(0,s.A)(),[P,M]=(0,i.useState)([]),[O,L]=(0,i.useState)(0),[J,U]=(0,i.useState)([]),[G,T]=(0,i.useState)(!0),[H,V]=(0,i.useState)(null),[q,Y]=(0,i.useState)({open:!1,message:"",severity:"success"}),[Z,Q]=(0,i.useState)("table"),[K,$]=(0,i.useState)(!1),[ee,et]=(0,i.useState)(""),[ep,ej]=(0,i.useState)(1),[eA,eb]=(0,i.useState)(""),[ev,ef]=(0,i.useState)([0,1e4]),[ey,ew]=(0,i.useState)("created_at"),[eC,eS]=(0,i.useState)("desc"),[ek,eI]=(0,i.useState)(""),ez=(0,i.useMemo)(()=>{if(!P.length)return{total:0,avgPrice:0,categories:0};let e=P.reduce((e,t)=>e+(t.price||0),0),t=new Set(P.map(e=>{var t;return null==(t=e.categories)?void 0:t.id}).filter(Boolean));return{total:O,avgPrice:e/P.length,categories:t.size}},[P,O]);(0,i.useEffect)(()=>{let e=setTimeout(()=>{eI(ee),ej(1)},300);return()=>clearTimeout(e)},[ee]),(0,i.useEffect)(()=>{(async()=>{let{data:e,error:a}=await t.from("categories").select("id, name").order("name");a||U(e||[])})()},[t]);let e_=(0,i.useCallback)(async()=>{T(!0),V(null);try{let e=t.from("slabs").select("\n          id, name, price, thumbnail_url, image_urls, grade_score,\n          sets (name), subsets (name), categories (id, name), grade_companies (name)\n        ",{count:"exact"});ek&&(e=e.ilike("name","%".concat(ek,"%"))),eA&&(e=e.eq("category_id",eA)),ev[0]>0&&(e=e.gte("price",ev[0])),ev[1]<1e4&&(e=e.lte("price",ev[1])),e=e.order(ey,{ascending:"asc"===eC});let a=(ep-1)*20;e=e.range(a,a+20-1);let{data:r,error:i,count:l}=await e;i?(V("Failed to load slabs: "+i.message),M([])):(M(r||[]),L(l||0))}catch(e){V("Failed to load slabs"),M([])}finally{T(!1)}},[t,ek,eA,ev,ey,eC,ep]);(0,i.useEffect)(()=>{e_()},[e_]);let eR=async()=>{Y({open:!0,message:"Export feature coming soon!",severity:"info"})},eF=()=>{et(""),eb(""),ef([0,1e4]),ew("created_at"),eS("desc"),ej(1)},eD=[ee,eA,ev[0]>0||ev[1]<1e4].filter(Boolean).length,eE=Math.ceil(O/20);return(0,r.jsxs)(n.A,{maxWidth:"xl",sx:{py:3},children:[(0,r.jsxs)(o.A,{"aria-label":"breadcrumb",sx:{mb:3},children:[(0,r.jsxs)(X(),{href:"/dashboard",style:{color:a.palette.text.primary,textDecoration:"none",display:"flex",alignItems:"center"},children:[(0,r.jsx)(ed.A,{sx:{mr:.5},fontSize:"small"}),"Dashboard"]}),(0,r.jsxs)(c.A,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(eh.A,{sx:{mr:.5},fontSize:"small"}),"Slabs Collection"]})]}),(0,r.jsx)(eg,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},elevation:2,sx:{p:4,mb:3,background:"linear-gradient(135deg, ".concat((0,d.X4)(a.palette.primary.main,.08)," 0%, ").concat((0,d.X4)(a.palette.secondary.main,.08)," 100%)"),borderRadius:3,border:"1px solid ".concat((0,d.X4)(a.palette.divider,.12)),position:"relative",overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"4px",background:"linear-gradient(90deg, ".concat(a.palette.primary.main,", ").concat(a.palette.secondary.main,")")}},children:(0,r.jsxs)(h.A,{direction:"row",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2,children:[(0,r.jsxs)(h.A,{direction:"row",alignItems:"center",spacing:3,children:[(0,r.jsx)(c.A,{variant:"h4",component:"h1",sx:{fontWeight:700,color:a.palette.text.primary,m:0},children:"Slabs"}),(0,r.jsx)(x.A,{icon:(0,r.jsx)(eh.A,{}),label:"".concat(ez.total," Total Slabs"),color:"primary",variant:"filled",sx:{fontWeight:600,height:40,"& .MuiChip-icon":{fontSize:20}}})]}),(0,r.jsxs)(h.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,r.jsx)(u.A,{title:"Export Collection",children:(0,r.jsx)(m.A,{onClick:eR,disabled:G,sx:{bgcolor:(0,d.X4)(a.palette.background.paper,.8),"&:hover":{bgcolor:(0,d.X4)(a.palette.background.paper,1),transform:"scale(1.05)"},transition:"all 0.2s ease"},children:(0,r.jsx)(el.A,{})})}),(0,r.jsx)(u.A,{title:"Refresh",children:(0,r.jsx)(m.A,{onClick:e_,disabled:G,sx:{bgcolor:(0,d.X4)(a.palette.background.paper,.8),"&:hover":{bgcolor:(0,d.X4)(a.palette.background.paper,1),transform:"scale(1.05)"},transition:"all 0.2s ease"},children:(0,r.jsx)(es.A,{})})}),(0,r.jsx)(g.A,{component:X(),href:"/dashboard/slabs/new",variant:"contained",color:"primary",size:"large",startIcon:(0,r.jsx)(er.A,{}),sx:{borderRadius:3,px:4,py:1.5,fontWeight:600,fontSize:"1rem",boxShadow:"0 4px 12px ".concat((0,d.X4)(a.palette.primary.main,.3)),"&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 20px ".concat((0,d.X4)(a.palette.primary.main,.4))},transition:"all 0.3s ease"},children:"Add New Slab"})]})]})}),(0,r.jsx)(l.A,{elevation:0,sx:{mb:3,p:2,borderRadius:2,border:"1px solid ".concat((0,d.X4)(a.palette.divider,.1))},children:(0,r.jsxs)(h.A,{direction:{xs:"column",md:"row"},spacing:2,alignItems:"center",children:[(0,r.jsx)(p.A,{placeholder:"Search slabs...",value:ee,onChange:e=>et(e.target.value),InputProps:{startAdornment:(0,r.jsx)(j.A,{position:"start",children:(0,r.jsx)(ei.A,{})}),endAdornment:ee&&(0,r.jsx)(j.A,{position:"end",children:(0,r.jsx)(m.A,{size:"small",onClick:()=>et(""),children:(0,r.jsx)(ex.A,{fontSize:"small"})})})},sx:{flexGrow:1,"& .MuiOutlinedInput-root":{borderRadius:2}}}),(0,r.jsxs)(h.A,{direction:"row",spacing:1,alignItems:"center",children:[(0,r.jsx)(A.A,{badgeContent:eD,color:"primary",children:(0,r.jsx)(g.A,{variant:"outlined",startIcon:(0,r.jsx)(ec.A,{}),onClick:()=>$(!0),sx:{borderRadius:2},children:"Filters"})}),eD>0&&(0,r.jsx)(b.A,{in:!0,children:(0,r.jsx)(g.A,{size:"small",onClick:eF,sx:{borderRadius:2},children:"Clear All"})}),(0,r.jsx)(v.A,{orientation:"vertical",flexItem:!0,sx:{mx:1}}),(0,r.jsxs)(f.A,{value:Z,exclusive:!0,onChange:(e,t)=>t&&Q(t),"aria-label":"view mode",size:"small",children:[(0,r.jsx)(y.A,{value:"table","aria-label":"table view",children:(0,r.jsx)(en.A,{})}),(0,r.jsx)(y.A,{value:"grid","aria-label":"grid view",children:(0,r.jsx)(eo.A,{})})]})]})]})}),eD>0&&(0,r.jsx)(w.A,{direction:"down",in:!0,mountOnEnter:!0,unmountOnExit:!0,children:(0,r.jsx)(C.A,{sx:{mb:2},children:(0,r.jsxs)(h.A,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:[ee&&(0,r.jsx)(x.A,{label:"Search: ".concat(ee),onDelete:()=>et(""),size:"small"}),eA&&(0,r.jsx)(x.A,{label:"Category: ".concat(null==(e=J.find(e=>e.id===eA))?void 0:e.name),onDelete:()=>eb(""),size:"small"}),(ev[0]>0||ev[1]<1e4)&&(0,r.jsx)(x.A,{label:"Price: ₹".concat(ev[0]," - ₹").concat(ev[1]),onDelete:()=>ef([0,1e4]),size:"small"})]})})}),H&&(0,r.jsx)(b.A,{in:!0,children:(0,r.jsx)(S.A,{severity:"error",sx:{mb:2},action:(0,r.jsx)(g.A,{color:"inherit",size:"small",onClick:e_,children:"Retry"}),children:H})}),G?(0,r.jsx)(C.A,{children:"grid"===Z?(0,r.jsx)(k.A,{container:!0,spacing:3,children:[...Array(8)].map((e,t)=>(0,r.jsx)(k.A,{item:!0,xs:12,sm:6,md:4,lg:3,children:(0,r.jsx)(I.A,{variant:"rectangular",height:320,sx:{borderRadius:2}})},t))}):[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsx)(I.A,{variant:"rectangular",height:80,sx:{mb:1,borderRadius:1}},t))}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(em.N,{mode:"wait",children:(0,r.jsx)(eu.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:(0,r.jsx)(ea,{slabs:P,onSlabDeleted:e=>{M(t=>t.filter(t=>t.id!==e)),L(e=>e-1),Y({open:!0,message:"Slab deleted successfully",severity:"success"})},viewMode:Z})},Z)}),eE>1&&(0,r.jsx)(C.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,r.jsx)(z.A,{count:eE,page:ep,onChange:(e,t)=>ej(t),color:"primary",size:"large",showFirstButton:!0,showLastButton:!0,sx:{"& .MuiPaginationItem-root":{borderRadius:2}}})})]}),(0,r.jsx)(_.Ay,{anchor:"right",open:K,onClose:()=>$(!1),PaperProps:{sx:{width:320,p:3,borderRadius:"16px 0 0 16px"}},children:(0,r.jsxs)(C.A,{children:[(0,r.jsxs)(h.A,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,r.jsx)(c.A,{variant:"h6",sx:{fontWeight:600},children:"Filters"}),(0,r.jsx)(m.A,{onClick:()=>$(!1),children:(0,r.jsx)(ex.A,{})})]}),(0,r.jsxs)(h.A,{spacing:3,children:[(0,r.jsxs)(R.A,{fullWidth:!0,children:[(0,r.jsx)(F.A,{children:"Category"}),(0,r.jsxs)(D.A,{value:eA,label:"Category",onChange:e=>{eb(e.target.value),ej(1)},children:[(0,r.jsx)(E.A,{value:"",children:(0,r.jsx)("em",{children:"All Categories"})}),J.map(e=>(0,r.jsx)(E.A,{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)(C.A,{children:[(0,r.jsxs)(c.A,{gutterBottom:!0,children:["Price Range: ₹",ev[0]," - ₹",ev[1]]}),(0,r.jsx)(N.Ay,{value:ev,onChange:(e,t)=>{ef(t),ej(1)},valueLabelDisplay:"auto",min:0,max:1e4,sx:{mt:2}})]}),(0,r.jsxs)(R.A,{fullWidth:!0,children:[(0,r.jsx)(F.A,{children:"Sort By"}),(0,r.jsxs)(D.A,{value:ey,label:"Sort By",onChange:e=>{ew(e.target.value),ej(1)},children:[(0,r.jsx)(E.A,{value:"created_at",children:"Date Added"}),(0,r.jsx)(E.A,{value:"name",children:"Name"}),(0,r.jsx)(E.A,{value:"price",children:"Price"}),(0,r.jsx)(E.A,{value:"grade_score",children:"Grade Score"})]})]}),(0,r.jsxs)(R.A,{fullWidth:!0,children:[(0,r.jsx)(F.A,{children:"Order"}),(0,r.jsxs)(D.A,{value:eC,label:"Order",onChange:e=>{eS(e.target.value),ej(1)},children:[(0,r.jsx)(E.A,{value:"desc",children:"Descending"}),(0,r.jsx)(E.A,{value:"asc",children:"Ascending"})]})]}),(0,r.jsx)(v.A,{}),(0,r.jsxs)(h.A,{direction:"row",spacing:2,children:[(0,r.jsx)(g.A,{fullWidth:!0,variant:"outlined",onClick:eF,children:"Clear All"}),(0,r.jsx)(g.A,{fullWidth:!0,variant:"contained",onClick:()=>$(!1),children:"Apply"})]})]})]})}),(0,r.jsx)(W.A,{open:q.open,autoHideDuration:6e3,onClose:()=>Y({...q,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,r.jsx)(S.A,{onClose:()=>Y({...q,open:!1}),severity:q.severity,variant:"filled",elevation:6,children:q.message})})]})}},91193:(e,t,a)=>{Promise.resolve().then(a.bind(a,59475))}},e=>{var t=t=>e(e.s=t);e.O(0,[1935,4127,5158,2842,9295,4801,8449,2110,6153,6874,1101,2330,5297,8987,5726,8939,6564,646,276,6923,8441,1684,7358],()=>t(91193)),_N_E=e.O()}]);