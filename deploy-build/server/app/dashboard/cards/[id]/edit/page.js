(()=>{var e={};e.id=4266,e.ids=[4266],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10348:(e,t,r)=>{Promise.resolve().then(r.bind(r,47535))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},10971:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c});var a=r(65239),i=r(48088),s=r(88170),n=r.n(s),o=r(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c={children:["",{children:["dashboard",{children:["cards",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,43289)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\cards\\[id]\\edit\\page.js"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,27577)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\layout.js"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,32648)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,d=["C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\cards\\[id]\\edit\\page.js"],u={require:r,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/dashboard/cards/[id]/edit/page",pathname:"/dashboard/cards/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},11997:e=>{"use strict";e.exports=require("punycode")},12892:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(23428),i=r(60687);let s=(0,a.A)((0,i.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},23500:(e,t,r)=>{Promise.resolve().then(r.bind(r,43289))},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},43289:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\siddh\\\\Documents\\\\tsuki-cms-2\\\\app\\\\dashboard\\\\cards\\\\[id]\\\\edit\\\\page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\cards\\[id]\\edit\\page.js","default")},47535:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>ed});var a=r(60687),i=r(43210),s=r(21360),n=r(89431),o=r(88931),l=r(87088),c=r(16184),d=r(69300),u=r(41434),h=r(66803),m=r(37204),g=r(24296),p=r(90764),x=r(97887),f=r(83487),A=r(72318),b=r(27674),v=r(85814),j=r.n(v),y=r(16189),C=r(2420),S=r(80986),w=r(49205),O=r(86862),P=r(51067),k=r(25685),E=r(16393),$=r(51711),R=r(23789),M=r(52260),z=r(41629),q=r(47651),_=r(91176),I=r(58534),T=r(18811),L=r(83685),D=r(76533),W=r(5294),F=r(87688),N=r(30476),B=r(49645),U=r(25495);r(85126);var G=r(26001),H=r(88920),J=r(77780),K=r(79628),V=r(102),X=r(37402),Y=r(29041),Q=r(12892),Z=r(77342),ee=r(43323),et=r(46380),er=r(71411),ea=r(88346),ei=r(72919),es=r(75396);let en=(0,r(23428).A)((0,a.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),eo=(0,G.P)(S.A);function el({initialCardData:e,initialCategories:t,onFormSubmitSuccess:r}){let n=(0,C.U)(),d=(0,s.A)(),{showToast:x}=(0,B.d)(),[f,A]=(0,i.useState)(""),[b,v]=(0,i.useState)(""),[j,y]=(0,i.useState)(""),[S,el]=(0,i.useState)(""),[ec,ed]=(0,i.useState)(""),[eu,eh]=(0,i.useState)(""),[em,eg]=(0,i.useState)("Japanese"),[ep,ex]=(0,i.useState)(t||[]),[ef,eA]=(0,i.useState)([]),[eb,ev]=(0,i.useState)([]),[ej,ey]=(0,i.useState)(!1),[eC,eS]=(0,i.useState)(null),[ew,eO]=(0,i.useState)(null),[eP,ek]=(0,i.useState)(!1),[eE,e$]=(0,i.useState)(!1),[eR,eM]=(0,i.useState)(null),[ez,eq]=(0,i.useState)([]),[e_,eI]=(0,i.useState)(null),[eT,eL]=(0,i.useState)([]),[eD,eW]=(0,i.useState)(null),[eF,eN]=(0,i.useState)(!1),[eB,eU]=(0,i.useState)(!1),[eG,eH]=(0,i.useState)(null),[eJ,eK]=(0,i.useState)({}),eV=async t=>{try{eS(null),ey(!0);let{error:r}=await n.from("cards").update({thumbnail_url:t}).eq("id",e.id);if(r)throw r;eW(t),x("Thumbnail updated successfully!",{severity:"success",title:"Success"})}catch(t){let e=`Failed to update thumbnail: ${t.message}`;eS(e),x(e,{severity:"error",title:"Error"})}finally{ey(!1)}},eX=async t=>{try{eS(null),ey(!0);let r=eT.filter(e=>e!==t),a=t===eD,i={image_urls:r};a&&(i.thumbnail_url=null);let{error:s}=await n.from("cards").update(i).eq("id",e.id);if(s)throw s;eL(r),a&&eW(null),x("Image removed successfully!",{severity:"success",title:"Success"})}catch(t){let e=`Failed to remove image: ${t.message}`;eS(e),x(e,{severity:"error",title:"Error"})}finally{ey(!1)}},eY=async t=>{if(t.preventDefault(),ey(!0),eS(null),eO(null),!f.trim()){eS("Card Name is required."),ey(!1);return}let a=parseFloat(ec);if(isNaN(a)||a<=0){eS("Price must be a positive number."),ey(!1);return}try{let t={name:f.trim(),category_id:b,set_id:j,subset_id:S,price:a,condition:eu.trim(),language:em.trim()};if(eF){let e=[];for(let t of ez){let r=new Date,a=r.getFullYear(),i=(r.getMonth()+1).toString().padStart(2,"0"),s=r.getDate().toString().padStart(2,"0"),o=`cards/${a}/${i}/${s}/${(0,U.A)()}.webp`,{error:l}=await n.storage.from("cardimages").upload(o,t,{contentType:t.type,upsert:!1});if(l)throw l;let{data:{publicUrl:c}}=n.storage.from("cardimages").getPublicUrl(o);e.push(c)}t.image_urls=[...eT,...e]}if(eB&&e_){let e=new Date,r=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),i=e.getDate().toString().padStart(2,"0"),s=`cards/${r}/${a}/${i}/${(0,U.A)()}_thumb.webp`,{error:o}=await n.storage.from("cardimages").upload(s,e_,{contentType:e_.type,upsert:!1});if(o)throw o;let{data:{publicUrl:l}}=n.storage.from("cardimages").getPublicUrl(s);t.thumbnail_url=l}let{error:i}=await n.from("cards").update(t).eq("id",e.id);if(i)throw i;eO("Card updated successfully!"),x("Card updated successfully!",{severity:"success",title:"Success"}),r&&setTimeout(()=>{r()},1500)}catch(t){let e=`Operation failed: ${t.message}`;eS(e),x(e,{severity:"error",title:"Error"})}finally{ey(!1)}},eQ=e=>{eM(e),e$(!0)};return(0,a.jsxs)(o.A,{sx:{maxWidth:800,mx:"auto",p:3},children:[(0,a.jsx)(l.A,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700,mb:3},children:"Edit Card"}),(0,a.jsxs)(w.A,{container:!0,spacing:2,sx:{mb:4},children:[(0,a.jsx)(w.A,{item:!0,xs:12,sm:6,md:3,children:(0,a.jsx)(eo,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:(0,a.jsxs)(O.A,{sx:{textAlign:"center"},children:[(0,a.jsx)(er.A,{color:"primary"}),(0,a.jsx)(l.A,{variant:"h6",children:eT.length}),(0,a.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Images"})]})})}),(0,a.jsx)(w.A,{item:!0,xs:12,sm:6,md:3,children:(0,a.jsx)(eo,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:(0,a.jsxs)(O.A,{sx:{textAlign:"center"},children:[(0,a.jsx)(ei.A,{color:"success"}),(0,a.jsxs)(l.A,{variant:"h6",children:["â‚¹",ec||"0"]}),(0,a.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Current Price"})]})})}),(0,a.jsx)(w.A,{item:!0,xs:12,sm:6,md:3,children:(0,a.jsx)(eo,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:(0,a.jsxs)(O.A,{sx:{textAlign:"center"},children:[(0,a.jsx)(K.A,{color:"info"}),(0,a.jsx)(l.A,{variant:"h6",children:ep.find(e=>e.id===b)?.name||"N/A"}),(0,a.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Category"})]})})}),(0,a.jsx)(w.A,{item:!0,xs:12,sm:6,md:3,children:(0,a.jsx)(eo,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:(0,a.jsxs)(O.A,{sx:{textAlign:"center"},children:[(0,a.jsx)(et.A,{color:"warning"}),(0,a.jsx)(l.A,{variant:"h6",children:eP?"Modified":"No Changes"}),(0,a.jsx)(l.A,{variant:"body2",color:"text.secondary",children:"Status"})]})})})]}),(0,a.jsx)(P.A,{elevation:0,sx:{borderRadius:2,overflow:"hidden"},children:(0,a.jsxs)(o.A,{component:"form",onSubmit:eY,sx:{p:3},children:[(0,a.jsxs)(H.N,{children:[eC&&(0,a.jsx)(G.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,a.jsx)(u.A,{severity:"error",sx:{mb:3},onClose:()=>eS(null),children:eC})}),ew&&(0,a.jsx)(G.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,a.jsx)(u.A,{severity:"success",sx:{mb:3},onClose:()=>eO(null),children:ew})})]}),(0,a.jsxs)(o.A,{sx:{mb:4},children:[(0,a.jsxs)(l.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(J.A,{color:"primary"}),"Basic Information"]}),(0,a.jsxs)(k.A,{spacing:3,children:[(0,a.jsx)(E.A,{fullWidth:!0,label:"Card Name",value:f,onChange:e=>A(e.target.value),required:!0,InputProps:{startAdornment:(0,a.jsx)($.A,{position:"start",children:(0,a.jsx)(ei.A,{color:"action"})})}}),(0,a.jsxs)(w.A,{container:!0,spacing:2,children:[(0,a.jsx)(w.A,{item:!0,xs:12,sm:6,children:(0,a.jsx)(E.A,{fullWidth:!0,label:"Price",type:"number",value:ec,onChange:e=>ed(e.target.value),InputProps:{inputProps:{min:0,step:"0.01"},startAdornment:(0,a.jsx)($.A,{position:"start",children:(0,a.jsx)(X.A,{color:"action"})})},required:!0})}),(0,a.jsx)(w.A,{item:!0,xs:12,sm:6,children:(0,a.jsxs)(R.A,{fullWidth:!0,required:!0,children:[(0,a.jsx)(M.A,{children:"Language"}),(0,a.jsxs)(z.A,{value:em,label:"Language",onChange:e=>eg(e.target.value),startAdornment:(0,a.jsx)($.A,{position:"start",children:(0,a.jsx)(ea.A,{color:"action"})}),children:[(0,a.jsx)(q.A,{value:"Japanese",children:"Japanese"}),(0,a.jsx)(q.A,{value:"English",children:"English"})]})]})})]}),(0,a.jsxs)(o.A,{children:[(0,a.jsx)(l.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Condition"}),(0,a.jsxs)(R.A,{fullWidth:!0,required:!0,children:[(0,a.jsx)(M.A,{children:"Condition"}),(0,a.jsxs)(z.A,{value:eu,label:"Condition",onChange:e=>eh(e.target.value),children:[(0,a.jsx)(q.A,{value:"10",children:"Gem Mint"}),(0,a.jsx)(q.A,{value:"9",children:"Mint"}),(0,a.jsx)(q.A,{value:"8",children:"Near Mint"}),(0,a.jsx)(q.A,{value:"7",children:"Excellent"}),(0,a.jsx)(q.A,{value:"6",children:"Good"}),(0,a.jsx)(q.A,{value:"5",children:"Fair"}),(0,a.jsx)(q.A,{value:"4",children:"Poor"})]})]})]})]})]}),(0,a.jsx)(_.A,{sx:{my:4}}),(0,a.jsxs)(o.A,{sx:{mb:4},children:[(0,a.jsxs)(l.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(K.A,{color:"primary"}),"Classification"]}),(0,a.jsxs)(k.A,{spacing:3,children:[(0,a.jsxs)(R.A,{fullWidth:!0,required:!0,children:[(0,a.jsx)(M.A,{children:"Category"}),(0,a.jsxs)(z.A,{value:b,label:"Category",onChange:e=>v(e.target.value),children:[(0,a.jsx)(q.A,{value:"",children:(0,a.jsx)("em",{children:"Select Category"})}),ep.map(e=>(0,a.jsx)(q.A,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)(R.A,{fullWidth:!0,required:!0,disabled:!b,children:[(0,a.jsx)(M.A,{children:"Set"}),(0,a.jsxs)(z.A,{value:j,label:"Set",onChange:e=>y(e.target.value),children:[(0,a.jsx)(q.A,{value:"",children:(0,a.jsx)("em",{children:"Select Set"})}),ef.map(e=>(0,a.jsx)(q.A,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)(R.A,{fullWidth:!0,required:!0,disabled:!j,children:[(0,a.jsx)(M.A,{children:"Subset"}),(0,a.jsxs)(z.A,{value:S,label:"Subset",onChange:e=>el(e.target.value),children:[(0,a.jsx)(q.A,{value:"",children:(0,a.jsx)("em",{children:"Select Subset"})}),eb.map(e=>(0,a.jsx)(q.A,{value:e.id,children:e.name},e.id))]})]})]})]}),(0,a.jsx)(_.A,{sx:{my:4}}),(0,a.jsxs)(o.A,{sx:{mb:4},children:[(0,a.jsxs)(l.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(er.A,{color:"primary"}),"Images & Thumbnail",(0,a.jsx)(I.A,{badgeContent:eT.length,color:"primary",children:(0,a.jsx)(o.A,{})})]}),eT.length>0&&(0,a.jsxs)(o.A,{sx:{mb:3},children:[(0,a.jsx)(l.A,{variant:"subtitle1",sx:{mb:2,fontWeight:600},children:"Current Images"}),(0,a.jsx)(w.A,{container:!0,spacing:2,children:eT.map((e,t)=>(0,a.jsx)(w.A,{item:!0,xs:6,sm:4,md:3,children:(0,a.jsxs)(eo,{whileHover:{scale:1.02},sx:{position:"relative",overflow:"hidden",borderRadius:2,border:e===eD?`2px solid ${d.palette.warning.main}`:"none"},children:[(0,a.jsxs)(o.A,{sx:{position:"relative",paddingTop:"140%",cursor:"pointer","&:hover .image-overlay":{opacity:1}},onClick:()=>eQ(e),children:[(0,a.jsx)(o.A,{component:"img",src:e,alt:`Card image ${t+1}`,sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover"}}),(0,a.jsxs)(o.A,{className:"image-overlay",sx:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 100%)",opacity:0,transition:"opacity 0.3s ease",display:"flex",flexDirection:"column",justifyContent:"space-between",p:1},children:[(0,a.jsxs)(o.A,{sx:{display:"flex",justifyContent:"flex-end",gap:.5},children:[(0,a.jsx)(T.A,{title:e===eD?"Current thumbnail":"Set as thumbnail",children:(0,a.jsx)(L.A,{size:"small",onClick:t=>{t.stopPropagation(),eV(e)},sx:{backgroundColor:"rgba(0,0,0,0.5)",color:"#fff","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:e===eD?(0,a.jsx)(Q.A,{fontSize:"small"}):(0,a.jsx)(Z.A,{fontSize:"small"})})}),(0,a.jsx)(T.A,{title:"Remove image",children:(0,a.jsx)(L.A,{size:"small",onClick:t=>{t.stopPropagation(),eX(e)},sx:{backgroundColor:"rgba(0,0,0,0.5)",color:"#fff","&:hover":{backgroundColor:"rgba(255,0,0,0.5)"}},children:(0,a.jsx)(ee.A,{fontSize:"small"})})})]}),(0,a.jsx)(o.A,{sx:{textAlign:"center"},children:(0,a.jsx)(D.A,{icon:(0,a.jsx)(es.A,{}),label:"Click to preview",size:"small",sx:{backgroundColor:"rgba(255,255,255,0.9)",fontSize:"0.7rem"}})})]})]}),e===eD&&(0,a.jsx)(D.A,{label:"Thumbnail",size:"small",color:"warning",sx:{position:"absolute",bottom:8,left:8,fontWeight:600}})]})},t))})]}),(0,a.jsx)(_.A,{sx:{my:3}}),(0,a.jsxs)(o.A,{children:[(0,a.jsx)(l.A,{variant:"subtitle1",sx:{mb:2,fontWeight:600},children:"Add New Images"}),(0,a.jsx)(u.A,{severity:"info",sx:{mb:2},children:"Upload new images to add to the existing collection. New images will be appended, not replaced."}),(0,a.jsx)(N.A,{bucketName:"cardimages",pathPrefix:"cards",onUploadComplete:e=>{let{mainImageFiles:t,thumbnailImageFile:r}=e;t&&t.length>0&&(eq(t),eN(!0)),r&&(eI(r),eU(!0))}},"image-uploader-edit"),(ez.length>0||e_)&&(0,a.jsx)(W.A,{in:!0,children:(0,a.jsxs)(u.A,{severity:"success",sx:{mt:2},icon:(0,a.jsx)(V.A,{}),children:[ez.length>0&&`${ez.length} new image(s) ready to upload. `,e_&&"New thumbnail selected."]})})]})]}),(0,a.jsx)(_.A,{sx:{my:3}}),(0,a.jsxs)(k.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,a.jsx)(c.A,{variant:"outlined",onClick:()=>window.history.back(),disabled:ej,children:"Cancel"}),(0,a.jsx)(c.A,{type:"submit",variant:"contained",disabled:ej||!eP,startIcon:ej?(0,a.jsx)(h.A,{size:20}):(0,a.jsx)(Y.A,{}),sx:{minWidth:150,background:eP&&!ej?`linear-gradient(45deg, ${d.palette.primary.main} 30%, ${d.palette.secondary.main} 90%)`:void 0},children:ej?"Saving...":eP?"Save Changes":"No Changes"})]})]})}),(0,a.jsxs)(m.A,{open:eE,onClose:()=>e$(!1),maxWidth:"md",fullWidth:!0,TransitionComponent:F.A,children:[(0,a.jsxs)(g.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Image Preview",(0,a.jsx)(L.A,{onClick:()=>e$(!1),children:(0,a.jsx)(en,{})})]}),(0,a.jsx)(p.A,{sx:{p:0},children:eR&&(0,a.jsx)(o.A,{component:"img",src:eR,alt:"Preview",sx:{width:"100%",height:"auto",maxHeight:"80vh",objectFit:"contain"}})})]})]})}(0,G.P)(o.A);var ec=r(12064);function ed(){let e=(0,y.useRouter)(),t=(0,y.useParams)().id,r=(0,C.U)(),v=(0,s.A)(),[S,w]=(0,i.useState)(null),[O,P]=(0,i.useState)([]),[k,E]=(0,i.useState)(!0),[$,R]=(0,i.useState)(null),[M,z]=(0,i.useState)(!1),[q,_]=(0,i.useState)(!1),[I,T]=(0,i.useState)(!1),[L,D]=(0,i.useState)(null);(0,i.useCallback)(async()=>{E(!0),R(null);try{let{data:e,error:a}=await r.from("cards").select("*").eq("id",t).single();if(a)throw Error(`Failed to load card: ${a.message}`);if(!e)throw Error("Card not found");w(e);let{data:i,error:s}=await r.from("categories").select("id, name");if(s)throw Error(`Failed to load categories: ${s.message}`);P(i||[])}catch(e){console.error("Error loading data:",e),R(e.message)}finally{E(!1)}},[r,t]);let W=async()=>{_(!0),D(null);try{if(console.log("Starting card deletion process for ID:",t),I)console.log("Force delete enabled - skipping image deletion");else{if(S.image_urls&&S.image_urls.length>0)for(let e of(console.log("Attempting to delete",S.image_urls.length,"images"),S.image_urls))try{console.log("Processing image URL:",e);let t=e.match(/\/storage\/v1\/object\/public\/cardimages\/(.*)/);if(t&&t[1]){let e=t[1];console.log("Extracted file path:",e);let{data:a,error:i}=await r.storage.from("cardimages").remove([e]);i?console.error("Failed to delete image:",i):console.log("Successfully deleted image from storage")}else console.log("Could not extract path from URL:",e)}catch(e){console.error("Error processing image deletion:",e)}if(S.thumbnail_url)try{console.log("Processing thumbnail URL:",S.thumbnail_url);let e=S.thumbnail_url.match(/\/storage\/v1\/object\/public\/cardimages\/(.*)/);if(e&&e[1]){let t=e[1];console.log("Extracted thumbnail path:",t);let{data:a,error:i}=await r.storage.from("cardimages").remove([t]);i?console.error("Failed to delete thumbnail:",i):console.log("Successfully deleted thumbnail from storage")}else console.log("Could not extract path from thumbnail URL:",S.thumbnail_url)}catch(e){console.error("Error processing thumbnail deletion:",e)}}console.log("Attempting to delete card from database with ID:",t);let{data:a,error:i}=await r.from("cards").delete().eq("id",t);if(console.log("Delete operation response:",{data:a,error:i}),i)throw console.error("Database deletion error details:",i),D(i),Error(`Failed to delete card: ${i.message}`);console.log("Card successfully deleted from database"),z(!1),e.push("/dashboard/cards")}catch(e){console.error("Error deleting card:",e),R(`Failed to delete card: ${e.message}`)}finally{_(!1)}};return(0,a.jsxs)(n.A,{maxWidth:"lg",children:[(0,a.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,a.jsx)(l.A,{variant:"h4",component:"h1",children:"Edit Card"}),(0,a.jsxs)(o.A,{sx:{display:"flex",gap:2},children:[(0,a.jsx)(c.A,{component:j(),href:"/dashboard/cards",variant:"outlined",startIcon:(0,a.jsx)(ec.A,{}),sx:{borderColor:"rgba(255,255,255,0.3)",color:"#fff","&:hover":{borderColor:"rgba(255,255,255,0.6)",backgroundColor:"rgba(255,255,255,0.1)"}},children:"BACK TO COLLECTION"}),(0,a.jsx)(c.A,{variant:"contained",color:"error",startIcon:(0,a.jsx)(ee.A,{}),onClick:()=>z(!0),sx:{"&:hover":{backgroundColor:(0,d.X4)(v.palette.error.main,.8)}},children:"DELETE"})]})]}),$&&(0,a.jsx)(u.A,{severity:"error",sx:{mb:3},children:$}),k?(0,a.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5,backgroundColor:"rgba(30, 30, 30, 0.8)",borderRadius:"8px"},children:[(0,a.jsx)(h.A,{}),(0,a.jsx)(l.A,{sx:{mt:2,color:"#fff"},children:"Loading card data..."})]}):(0,a.jsx)(el,{initialCardData:S,initialCategories:O,onFormSubmitSuccess:()=>{e.push("/dashboard/cards")}}),(0,a.jsxs)(m.A,{open:M,onClose:()=>!q&&z(!1),PaperProps:{sx:{backgroundColor:"#1E1E1E",color:"#fff",borderRadius:"8px"}},children:[(0,a.jsx)(g.A,{children:"Delete Card"}),(0,a.jsxs)(p.A,{children:[(0,a.jsx)(x.A,{sx:{color:"rgba(255, 255, 255, 0.8)"},children:"Are you sure you want to delete this card? This action cannot be undone and will remove all associated images from storage."}),L&&(0,a.jsxs)(u.A,{severity:"error",sx:{mt:2},children:[(0,a.jsxs)(l.A,{variant:"body2",children:["Error Code: ",L.code]}),(0,a.jsxs)(l.A,{variant:"body2",children:["Message: ",L.message]}),(0,a.jsxs)(l.A,{variant:"body2",children:["Details: ",L.details]}),(0,a.jsxs)(l.A,{variant:"body2",children:["Hint: ",L.hint]})]}),(0,a.jsx)(f.A,{control:(0,a.jsx)(A.A,{checked:I,onChange:e=>T(e.target.checked),sx:{color:v.palette.error.main}}),label:"Force delete (skip image deletion)",sx:{mt:2,color:v.palette.error.main}})]}),(0,a.jsxs)(b.A,{sx:{p:2},children:[(0,a.jsx)(c.A,{onClick:()=>z(!1),color:"primary",disabled:q,children:"Cancel"}),(0,a.jsx)(c.A,{onClick:W,variant:"contained",color:"error",disabled:q,startIcon:q?(0,a.jsx)(h.A,{size:20}):(0,a.jsx)(ee.A,{}),autoFocus:!0,children:q?"Deleting...":"Delete"})]})]})]})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},58534:(e,t,r)=>{"use strict";r.d(t,{A:()=>C});var a=r(43210),i=r(49384);let s=e=>{let t=a.useRef({});return a.useEffect(()=>{t.current=e}),t.current};var n=r(99282);let o=function(e){let{badgeContent:t,invisible:r=!1,max:a=99,showZero:i=!1}=e,n=s({badgeContent:t,max:a}),o=r;!1!==r||0!==t||i||(o=!0);let{badgeContent:l,max:c=a}=o?n:e,d=l&&Number(l)>c?`${c}+`:l;return{badgeContent:l,invisible:o,max:c,displayValue:d}};var l=r(13555),c=r(45258),d=r(48285),u=r(84754),h=r(61543),m=r(4144),g=r(82816);function p(e){return(0,g.Ay)("MuiBadge",e)}let x=(0,m.A)("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]);var f=r(34414),A=r(60687);let b=e=>{let{color:t,anchorOrigin:r,invisible:a,overlap:i,variant:s,classes:o={}}=e,l={root:["root"],badge:["badge",s,a&&"invisible",`anchorOrigin${(0,h.A)(r.vertical)}${(0,h.A)(r.horizontal)}`,`anchorOrigin${(0,h.A)(r.vertical)}${(0,h.A)(r.horizontal)}${(0,h.A)(i)}`,`overlap${(0,h.A)(i)}`,"default"!==t&&`color${(0,h.A)(t)}`]};return(0,n.A)(l,p,o)},v=(0,l.Ay)("span",{name:"MuiBadge",slot:"Root"})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),j=(0,l.Ay)("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.badge,t[r.variant],t[`anchorOrigin${(0,h.A)(r.anchorOrigin.vertical)}${(0,h.A)(r.anchorOrigin.horizontal)}${(0,h.A)(r.overlap)}`],"default"!==r.color&&t[`color${(0,h.A)(r.color)}`],r.invisible&&t.invisible]}})((0,c.A)(({theme:e})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:20,lineHeight:1,padding:"0 6px",height:20,borderRadius:10,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen}),variants:[...Object.entries(e.palette).filter((0,d.A)(["contrastText"])).map(([t])=>({props:{color:t},style:{backgroundColor:(e.vars||e).palette[t].main,color:(e.vars||e).palette[t].contrastText}})),{props:{variant:"dot"},style:{borderRadius:4,height:8,minWidth:8,padding:0}},{props:({ownerState:e})=>"top"===e.anchorOrigin.vertical&&"right"===e.anchorOrigin.horizontal&&"rectangular"===e.overlap,style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${x.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>"bottom"===e.anchorOrigin.vertical&&"right"===e.anchorOrigin.horizontal&&"rectangular"===e.overlap,style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${x.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>"top"===e.anchorOrigin.vertical&&"left"===e.anchorOrigin.horizontal&&"rectangular"===e.overlap,style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${x.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>"bottom"===e.anchorOrigin.vertical&&"left"===e.anchorOrigin.horizontal&&"rectangular"===e.overlap,style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${x.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:e})=>"top"===e.anchorOrigin.vertical&&"right"===e.anchorOrigin.horizontal&&"circular"===e.overlap,style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${x.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>"bottom"===e.anchorOrigin.vertical&&"right"===e.anchorOrigin.horizontal&&"circular"===e.overlap,style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${x.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>"top"===e.anchorOrigin.vertical&&"left"===e.anchorOrigin.horizontal&&"circular"===e.overlap,style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${x.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>"bottom"===e.anchorOrigin.vertical&&"left"===e.anchorOrigin.horizontal&&"circular"===e.overlap,style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${x.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})}}]})));function y(e){return{vertical:e?.vertical??"top",horizontal:e?.horizontal??"right"}}let C=a.forwardRef(function(e,t){let r=(0,u.b)({props:e,name:"MuiBadge"}),{anchorOrigin:a,className:n,classes:l,component:c,components:d={},componentsProps:h={},children:m,overlap:g="rectangular",color:p="default",invisible:x=!1,max:C=99,badgeContent:S,slots:w,slotProps:O,showZero:P=!1,variant:k="standard",...E}=r,{badgeContent:$,invisible:R,max:M,displayValue:z}=o({max:C,invisible:x,badgeContent:S,showZero:P}),q=s({anchorOrigin:y(a),color:p,overlap:g,variant:k,badgeContent:S}),_=R||null==$&&"dot"!==k,{color:I=p,overlap:T=g,anchorOrigin:L,variant:D=k}=_?q:r,W=y(L),F="dot"!==D?z:void 0,N={...r,badgeContent:$,invisible:_,max:M,displayValue:F,showZero:P,anchorOrigin:W,color:I,overlap:T,variant:D},B=b(N),U={slots:{root:w?.root??d.Root,badge:w?.badge??d.Badge},slotProps:{root:O?.root??h.root,badge:O?.badge??h.badge}},[G,H]=(0,f.A)("root",{elementType:v,externalForwardedProps:{...U,...E},ownerState:N,className:(0,i.A)(B.root,n),ref:t,additionalProps:{as:c}}),[J,K]=(0,f.A)("badge",{elementType:j,externalForwardedProps:U,ownerState:N,className:B.badge});return(0,A.jsxs)(G,{...H,children:[m,(0,A.jsx)(J,{...K,children:F})]})})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},72919:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(23428),i=r(60687);let s=(0,a.A)((0,i.jsx)("path",{d:"m21.41 11.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58s1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41s-.23-1.06-.59-1.42M5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7"}),"LocalOffer")},74075:e=>{"use strict";e.exports=require("zlib")},75396:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(23428),i=r(60687);let s=(0,a.A)((0,i.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility")},77342:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(23428),i=r(60687);let s=(0,a.A)((0,i.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},80986:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var a=r(43210),i=r(49384),s=r(99282),n=r(13555),o=r(84754),l=r(51067),c=r(4144),d=r(82816);function u(e){return(0,d.Ay)("MuiCard",e)}(0,c.A)("MuiCard",["root"]);var h=r(60687);let m=e=>{let{classes:t}=e;return(0,s.A)({root:["root"]},u,t)},g=(0,n.Ay)(l.A,{name:"MuiCard",slot:"Root"})({overflow:"hidden"}),p=a.forwardRef(function(e,t){let r=(0,o.b)({props:e,name:"MuiCard"}),{className:a,raised:s=!1,...n}=r,l={...r,raised:s},c=m(l);return(0,h.jsx)(g,{className:(0,i.A)(c.root,a),elevation:s?8:void 0,ref:t,ownerState:l,...n})})},81630:e=>{"use strict";e.exports=require("http")},86862:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var a=r(43210),i=r(49384),s=r(99282),n=r(13555),o=r(84754),l=r(4144),c=r(82816);function d(e){return(0,c.Ay)("MuiCardContent",e)}(0,l.A)("MuiCardContent",["root"]);var u=r(60687);let h=e=>{let{classes:t}=e;return(0,s.A)({root:["root"]},d,t)},m=(0,n.Ay)("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}}),g=a.forwardRef(function(e,t){let r=(0,o.b)({props:e,name:"MuiCardContent"}),{className:a,component:s="div",...n}=r,l={...r,component:s},c=h(l);return(0,u.jsx)(m,{as:s,className:(0,i.A)(c.root,a),ownerState:l,ref:t,...n})})},87688:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var a=r(43210),i=r(5526),s=r(76070),n=r(21360),o=r(20077),l=r(6065),c=r(60687);let d={entering:{transform:"none"},entered:{transform:"none"}},u=a.forwardRef(function(e,t){let r=(0,n.A)(),u={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:h,appear:m=!0,children:g,easing:p,in:x,onEnter:f,onEntered:A,onEntering:b,onExit:v,onExited:j,onExiting:y,style:C,timeout:S=u,TransitionComponent:w=i.Ay,...O}=e,P=a.useRef(null),k=(0,l.A)(P,(0,s.A)(g),t),E=e=>t=>{if(e){let r=P.current;void 0===t?e(r):e(r,t)}},$=E(b),R=E((e,t)=>{(0,o.q)(e);let a=(0,o.c)({style:C,timeout:S,easing:p},{mode:"enter"});e.style.webkitTransition=r.transitions.create("transform",a),e.style.transition=r.transitions.create("transform",a),f&&f(e,t)}),M=E(A),z=E(y),q=E(e=>{let t=(0,o.c)({style:C,timeout:S,easing:p},{mode:"exit"});e.style.webkitTransition=r.transitions.create("transform",t),e.style.transition=r.transitions.create("transform",t),v&&v(e)}),_=E(j);return(0,c.jsx)(w,{appear:m,in:x,nodeRef:P,onEnter:R,onEntered:M,onEntering:$,onExit:q,onExited:_,onExiting:z,addEndListener:e=>{h&&h(P.current,e)},timeout:S,...O,children:(e,{ownerState:t,...r})=>a.cloneElement(g,{style:{transform:"scale(0)",visibility:"exited"!==e||x?void 0:"hidden",...d[e],...C,...g.props.style},ref:k,...r})})})},88346:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(23428),i=r(60687);let s=(0,a.A)((0,i.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2m6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56M12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96M4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56m2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8M12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96M14.34 14H9.66c-.09-.66-.16-1.32-.16-2s.07-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2m.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56M16.36 14c.08-.66.14-1.32.14-2s-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2z"}),"Language")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,1103,1658,4468,2153,4112,8164,8102,6393,9205,5814,6533,8743,8811,8064,1394,4005,3156,476],()=>r(10971));module.exports=a})();