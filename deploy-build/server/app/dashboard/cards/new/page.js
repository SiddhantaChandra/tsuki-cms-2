(()=>{var e={};e.id=5264,e.ids=[5264],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},28323:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\siddh\\\\Documents\\\\tsuki-cms-2\\\\app\\\\dashboard\\\\cards\\\\new\\\\page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\cards\\new\\page.js","default")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},35463:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>c,pages:()=>u,routeModule:()=>m,tree:()=>d});var s=t(65239),i=t(48088),a=t(88170),n=t.n(a),l=t(30893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(r,o);let d={children:["",{children:["dashboard",{children:["cards",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,28323)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\cards\\new\\page.js"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,27577)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\layout.js"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,32648)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,u=["C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\cards\\new\\page.js"],c={require:t,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/dashboard/cards/new/page",pathname:"/dashboard/cards/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},41356:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>Z});var s=t(60687),i=t(43210),a=t(21360),n=t(89431),l=t(88931),o=t(68887),d=t(87088),u=t(16184),c=t(80986),m=t(69300),h=t(86862),x=t(85814),p=t.n(x),g=t(16189),j=t(2420),A=t(66803),f=t(41434),b=t(51067),v=t(25685),y=t(16393),C=t(51711),S=t(49205),w=t(23789),q=t(52260),P=t(41629),I=t(47651),k=t(91176),_=t(5294),D=t(76533),F=t(30476),$=t(49645),N=t(25495),U=t(85126),E=t.n(U),z=t(26001),M=t(88920),W=t(77780),R=t(79628),T=t(102);let G=(0,t(23428).A)((0,s.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"ErrorOutline");var L=t(37402),B=t(12064),O=t(29041),J=t(72919),X=t(88346),H=t(71411);function K({initialCategories:e,onFormSubmitSuccess:r,loadingCategories:t,categoryError:n}){console.log("[NewCardForm] Function body execution (render start). LoadingCategories:",t,"CategoryError:",n);let o=(0,j.U)(),c=(0,a.A)(),{showToast:m}=(0,$.d)(),[h,x]=(0,i.useState)(""),[g,U]=(0,i.useState)(""),[K,Y]=(0,i.useState)(""),[Q,V]=(0,i.useState)(""),[Z,ee]=(0,i.useState)(""),[er,et]=(0,i.useState)("10"),[es,ei]=(0,i.useState)("Japanese"),[ea,en]=(0,i.useState)(e||[]),[el,eo]=(0,i.useState)([]),[ed,eu]=(0,i.useState)([]),[ec,em]=(0,i.useState)(!1),[eh,ex]=(0,i.useState)(null),[ep,eg]=(0,i.useState)(null),[ej,eA]=(0,i.useState)(0),[ef,eb]=(0,i.useState)([]),[ev,ey]=(0,i.useState)(null);(0,i.useRef)(!0);let eC=(0,i.useRef)(0);(0,i.useRef)(null),eC.current+=1;let eS=async e=>{if(e.preventDefault(),em(!0),ex(null),eg(null),!h.trim()){ex("Card Name is required."),m("Card Name is required.",{severity:"error"}),em(!1);return}if(0===ef.length){ex("At least one card image is required."),m("At least one card image is required.",{severity:"error"}),em(!1);return}if(!ev){ex('Thumbnail is required. Please use the "Make Thumb" button on one of the images.'),m("Thumbnail is required.",{severity:"error"}),em(!1);return}if(!g){ex("Category is required."),m("Category is required.",{severity:"error"}),em(!1);return}if(!K){ex("Set is required."),m("Set is required.",{severity:"error"}),em(!1);return}if(!Q){ex("Subset is required."),m("Subset is required.",{severity:"error"}),em(!1);return}if(!er.trim()){ex("Condition is required."),m("Condition is required.",{severity:"error"}),em(!1);return}if(!es.trim()){ex("Language is required."),m("Language is required.",{severity:"error"}),em(!1);return}let t=parseFloat(Z);if(isNaN(t)||t<=0){ex("Price must be a positive number."),m("Price must be a positive number.",{severity:"error"}),em(!1);return}if(n){ex("Cannot submit, categories failed to load."),m("Cannot submit, categories failed to load.",{severity:"error"}),em(!1);return}try{let e=h.trim(),t=E()(e,{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g}),s=(0,N.A)().substring(0,8),i=`${t}-${s}`,a=[],n=null;for(let e of ef){e.name.substring(0,e.name.lastIndexOf(".")||e.name.length);let r=new Date,t=r.getFullYear(),s=(r.getMonth()+1).toString().padStart(2,"0"),i=r.getDate().toString().padStart(2,"0"),n=`cards/${t}/${s}/${i}/${(0,N.A)()}.webp`,{error:l}=await o.storage.from("cardimages").upload(n,e,{contentType:e.type,upsert:!1});if(l)throw Error(`Failed to upload main image ${e.name}: ${l.message}`);let{data:{publicUrl:d}}=o.storage.from("cardimages").getPublicUrl(n);a.push(d)}if(ev){ev.name.substring(0,ev.name.lastIndexOf(".")||ev.name.length);let e=new Date,r=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getDate().toString().padStart(2,"0"),i=`cards/${r}/${t}/${s}/${(0,N.A)()}_thumb.webp`,{error:a}=await o.storage.from("cardimages").upload(i,ev,{contentType:ev.type,upsert:!1});if(a)throw Error(`Failed to upload thumbnail ${ev.name}: ${a.message}`);let{data:{publicUrl:l}}=o.storage.from("cardimages").getPublicUrl(i);n=l}let l={name:e,slug:i,image_urls:a,thumbnail_url:n,category_id:g,set_id:K||null,subset_id:Q||null,price:parseFloat(Z)||null,condition:er.trim()||null,language:es.trim()||null};console.log("Inserting card data:",l);let{error:d}=await o.from("cards").insert(l);if(d)throw Error(`Failed to insert card: ${d.message}`);m("Card added successfully!",{severity:"success",title:"Success"}),x(""),U(""),Y(""),V(""),ee(""),et(""),ei(""),eb([]),ey(null),eA(e=>e+1),eg("Card added successfully!"),r&&r()}catch(r){let e=`Operation failed: ${r.message}`;ex(e),m(e,{severity:"error",title:"Error"}),console.error("Submit Error Details:",r)}finally{em(!1)}};return(console.log("[NewCardForm] Returning JSX. Current state snapshot just before render:",{uploadedMainImageFilesCount:ef.length,uploadedThumbnailFileName:ev?.name}),t)?(0,s.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,s.jsx)(A.A,{}),(0,s.jsx)(d.A,{sx:{mt:2},children:"Loading form data..."})]}):n?(0,s.jsx)(f.A,{severity:"error",sx:{mb:3,mt:2},icon:(0,s.jsx)(G,{fontSize:"large"}),children:"string"==typeof n?n:"An error occurred while loading essential data for the form."}):(0,s.jsxs)(l.A,{sx:{maxWidth:800,mx:"auto",p:3},children:[(0,s.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,s.jsx)(d.A,{variant:"h4",component:"h1",sx:{fontWeight:700},children:"Add New Card"}),(0,s.jsx)(u.A,{component:p(),href:"/dashboard/cards",variant:"outlined",startIcon:(0,s.jsx)(B.A,{}),sx:{borderRadius:2},children:"Back to Collection"})]}),t&&(0,s.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,s.jsx)(A.A,{}),(0,s.jsx)(d.A,{sx:{mt:2},children:"Loading form data..."})]}),n&&(0,s.jsx)(f.A,{severity:"error",sx:{mb:3,mt:2},icon:(0,s.jsx)(G,{fontSize:"large"}),children:"string"==typeof n?n:"An error occurred while loading essential data for the form."}),!t&&!n&&(0,s.jsx)(b.A,{elevation:0,sx:{borderRadius:2,overflow:"hidden"},children:(0,s.jsxs)(l.A,{component:"form",onSubmit:eS,sx:{p:3},children:[(0,s.jsxs)(M.N,{children:[eh&&(0,s.jsx)(z.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,s.jsx)(f.A,{severity:"error",sx:{mb:3},onClose:()=>ex(null),children:eh})}),ep&&(0,s.jsx)(z.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,s.jsx)(f.A,{severity:"success",sx:{mb:3},onClose:()=>eg(null),children:ep})})]}),(0,s.jsxs)(l.A,{sx:{mb:4},children:[(0,s.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,s.jsx)(W.A,{color:"primary"}),"Basic Information"]}),(0,s.jsxs)(v.A,{spacing:3,children:[(0,s.jsx)(y.A,{fullWidth:!0,label:"Card Name",value:h,onChange:e=>x(e.target.value),required:!0,InputProps:{startAdornment:(0,s.jsx)(C.A,{position:"start",children:(0,s.jsx)(J.A,{color:"action"})})}}),(0,s.jsxs)(S.A,{container:!0,spacing:2,children:[(0,s.jsx)(S.A,{item:!0,xs:12,sm:6,children:(0,s.jsx)(y.A,{fullWidth:!0,label:"Price",type:"number",value:Z,onChange:e=>ee(e.target.value),InputProps:{inputProps:{min:0,step:"0.01"},startAdornment:(0,s.jsx)(C.A,{position:"start",children:(0,s.jsx)(L.A,{color:"action"})})},required:!0})}),(0,s.jsx)(S.A,{item:!0,xs:12,sm:6,children:(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,s.jsx)(q.A,{children:"Language"}),(0,s.jsxs)(P.A,{value:es,label:"Language",onChange:e=>ei(e.target.value),startAdornment:(0,s.jsx)(C.A,{position:"start",children:(0,s.jsx)(X.A,{color:"action"})}),children:[(0,s.jsx)(I.A,{value:"Japanese",children:"Japanese"}),(0,s.jsx)(I.A,{value:"English",children:"English"})]})]})})]}),(0,s.jsxs)(l.A,{children:[(0,s.jsx)(d.A,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Condition"}),(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,s.jsx)(q.A,{children:"Condition"}),(0,s.jsxs)(P.A,{value:er,label:"Condition",onChange:e=>et(e.target.value),children:[(0,s.jsx)(I.A,{value:"10",children:"Gem Mint"}),(0,s.jsx)(I.A,{value:"9",children:"Mint"}),(0,s.jsx)(I.A,{value:"8",children:"Near Mint"}),(0,s.jsx)(I.A,{value:"7",children:"Excellent"}),(0,s.jsx)(I.A,{value:"6",children:"Good"}),(0,s.jsx)(I.A,{value:"5",children:"Fair"}),(0,s.jsx)(I.A,{value:"4",children:"Poor"})]})]})]})]})]}),(0,s.jsx)(k.A,{sx:{my:4}}),(0,s.jsxs)(l.A,{sx:{mb:4},children:[(0,s.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,s.jsx)(R.A,{color:"primary"}),"Classification"]}),(0,s.jsxs)(v.A,{spacing:3,children:[(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,s.jsx)(q.A,{children:"Category"}),(0,s.jsxs)(P.A,{value:g,label:"Category",onChange:e=>U(e.target.value),children:[(0,s.jsx)(I.A,{value:"",children:(0,s.jsx)("em",{children:"Select Category"})}),ea.map(e=>(0,s.jsx)(I.A,{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!g,children:[(0,s.jsx)(q.A,{children:"Set"}),(0,s.jsxs)(P.A,{value:K,label:"Set",onChange:e=>Y(e.target.value),children:[(0,s.jsx)(I.A,{value:"",children:(0,s.jsx)("em",{children:"Select Set"})}),el.map(e=>(0,s.jsx)(I.A,{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!K,children:[(0,s.jsx)(q.A,{children:"Subset"}),(0,s.jsxs)(P.A,{value:Q,label:"Subset",onChange:e=>V(e.target.value),children:[(0,s.jsx)(I.A,{value:"",children:(0,s.jsx)("em",{children:"Select Subset"})}),ed.map(e=>(0,s.jsxs)(I.A,{value:e.id,children:[e.name," - ",e.slug]},e.id))]})]})]})]}),(0,s.jsx)(k.A,{sx:{my:4}}),(0,s.jsxs)(l.A,{sx:{mb:4},children:[(0,s.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,s.jsx)(H.A,{color:"primary"}),"Images & Thumbnail"]}),(0,s.jsx)(f.A,{severity:"info",sx:{mb:2},children:"Upload clear images of your card. At least one image and a thumbnail are required."}),(0,s.jsx)(F.A,{bucketName:"cardimages",pathPrefix:"cards",onUploadComplete:e=>{console.log("[NewCardForm] handleImageUploadComplete called. Data:",e);let{mainImageFiles:r,thumbnailImageFile:t}=e,s=r||[],i=t||null;console.log("[NewCardForm] Before set state in handleImageUploadComplete. Current main files count:",ef.length,"Current thumb:",ev?.name),eb(s),ey(i),console.log("[NewCardForm] After set state in handleImageUploadComplete. Attempted to set main files count:",s.length,"Attempted thumb:",i?.name)},resetKey:ej}),ef.length>0&&(0,s.jsx)(_.A,{in:!0,children:(0,s.jsxs)(f.A,{severity:"success",sx:{mt:2},icon:(0,s.jsx)(T.A,{}),children:[ef.length," image(s) ready.",ev?" Thumbnail is set.":' Please select a thumbnail using the "Make Thumb" button.']})}),(0,s.jsxs)(v.A,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,sx:{mt:2},children:[(0,s.jsx)(D.A,{label:"Upload clear images",size:"small",variant:"outlined"}),(0,s.jsx)(D.A,{label:"Create thumbnail from best image",size:"small",variant:"outlined"}),(0,s.jsx)(D.A,{label:"Add multiple angles if available",size:"small",variant:"outlined"})]})]}),(0,s.jsx)(k.A,{sx:{my:3}}),(0,s.jsxs)(v.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,s.jsx)(u.A,{variant:"outlined",onClick:()=>window.history.back(),disabled:ec,children:"Cancel"}),(0,s.jsx)(u.A,{type:"submit",variant:"contained",disabled:ec,startIcon:ec?(0,s.jsx)(A.A,{size:20}):(0,s.jsx)(O.A,{}),sx:{minWidth:200,background:ec?void 0:`linear-gradient(45deg, ${c.palette.primary.main} 30%, ${c.palette.secondary.main} 90%)`},children:ec?"Adding Card...":"Add Card to Collection"})]})]})})]})}(0,z.P)(c.A),(0,z.P)(l.A);var Y=t(21001),Q=t(31267),V=t(94035);function Z(){let e=(0,g.useRouter)();(0,j.U)();let r=(0,a.A)(),[t,x]=(0,i.useState)([]),[A,f]=(0,i.useState)(!0),[b,v]=(0,i.useState)(null);return(0,s.jsxs)(n.A,{maxWidth:"lg",sx:{py:4},children:[(0,s.jsx)(l.A,{sx:{mb:3},children:(0,s.jsxs)(o.A,{"aria-label":"breadcrumb",children:[(0,s.jsxs)(p(),{href:"/dashboard",passHref:!0,style:{color:r.palette.text.primary,textDecoration:"none",display:"flex",alignItems:"center"},children:[(0,s.jsx)(Q.A,{sx:{mr:.5},fontSize:"small"}),"Dashboard"]}),(0,s.jsxs)(p(),{href:"/dashboard/cards",passHref:!0,style:{color:r.palette.text.primary,textDecoration:"none",display:"flex",alignItems:"center"},children:[(0,s.jsx)(V.A,{sx:{mr:.5},fontSize:"small"}),"Cards"]}),(0,s.jsxs)(d.A,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[(0,s.jsx)(Y.A,{sx:{mr:.5},fontSize:"small"}),"Add New Card"]})]})}),(0,s.jsxs)(l.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:3},children:[(0,s.jsx)(d.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Add New Card"}),(0,s.jsx)(u.A,{startIcon:(0,s.jsx)(B.A,{}),variant:"outlined",onClick:()=>e.push("/dashboard/cards"),sx:{mb:{xs:2,sm:0}},children:"Back to Collection"})]}),(0,s.jsx)(c.A,{elevation:3,sx:{overflow:"visible",borderRadius:2,boxShadow:e=>`0 8px 32px ${(0,m.X4)(e.palette.primary.main,.1)}`},children:(0,s.jsx)(h.A,{sx:{p:{xs:2,sm:3,md:4}},children:(0,s.jsx)(K,{initialCategories:t,loadingCategories:A,categoryError:b,onFormSubmitSuccess:()=>{console.log("NewCardForm submitted successfully from page")}})})})]})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78641:(e,r,t)=>{Promise.resolve().then(t.bind(t,41356))},79313:(e,r,t)=>{Promise.resolve().then(t.bind(t,28323))},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,1103,1658,4468,2153,4112,8164,8102,6393,9205,5814,6533,8743,8064,822,3156,476],()=>t(35463));module.exports=s})();