(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4905],{268:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(57515),a=s(95155);let i=(0,t.A)((0,a.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"}),"Description")},20605:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(57515),a=s(95155);let i=(0,t.A)((0,a.jsx)("path",{d:"M12 13V9c0-.55-.45-1-1-1H7V6h5V4H9.5V3h-2v1H6c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h4v2H5v2h2.5v1h2v-1H11c.55 0 1-.45 1-1m7.59-.48-5.66 5.65-2.83-2.83-1.41 1.42L13.93 21 21 13.93z"}),"PriceCheck")},29982:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(57515),a=s(95155);let i=(0,t.A)((0,a.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link")},32922:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(57515),a=s(95155);let i=(0,t.A)((0,a.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory")},62554:(e,r,s)=>{Promise.resolve().then(s.bind(s,76437))},76437:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>K});var t=s(95155),a=s(12115),i=s(67217),l=s(700),n=s(14426),c=s(92302),o=s(55954),d=s(35695),u=s(51368),h=s(96262),m=s.n(h),p=s(16324),g=s(54581),x=s(68534),A=s(18407),y=s(71803),j=s(78449),b=s(33989),v=s(35297),f=s(74964),C=s(72110),S=s(27088),I=s(17348),w=s(68104),k=s(76380),T=s(64329),P=s(14962),q=s(96040),H=s(29982),N=s(268),V=s(32922),_=s(51935),W=s(46108),E=s(80946),z=s(20605),U=s(52671),D=s(38464),L=s(91058),M=s(15760),O=s(6874),F=s.n(O),B=s(60760),R=s(76408);function G(e){let{categories:r}=e,s=(0,o.U)(),i=(0,d.useRouter)(),h=(0,p.A)(),[O,G]=(0,a.useState)(""),[K,Q]=(0,a.useState)(""),[J,X]=(0,a.useState)(""),[Y,Z]=(0,a.useState)(""),[$,ee]=(0,a.useState)(""),[er,es]=(0,a.useState)(""),[et,ea]=(0,a.useState)(""),[ei,el]=(0,a.useState)([]),[en,ec]=(0,a.useState)(null),[eo,ed]=(0,a.useState)(!1),[eu,eh]=(0,a.useState)(null),[em,ep]=(0,a.useState)({}),[eg,ex]=(0,a.useState)(!1),[eA,ey]=(0,a.useState)(0),ej=(0,a.useCallback)(e=>{if(e){let r=(0,u.A)().slice(0,8);Q(m()("".concat(e,"-").concat(r),{lower:!0,strict:!0,remove:/[*+~.()'"!:@]/g}))}else Q("")},[]),eb=()=>{let e={};return O.trim()||(e.name="Name is required."),K.trim()||(e.slug="Slug is required (auto-generated from name)."),Y||(e.categoryId="Category is required."),et||(e.accessoryType="Accessory type is required."),(!$||isNaN(parseFloat($))||0>=parseFloat($))&&(e.price="Valid price is required."),(!er||isNaN(parseInt(er))||0>parseInt(er))&&(e.stock="Valid stock quantity is required."),0===ei.length&&(e.images="At least one image is required."),en||(e.images=e.images?e.images+" Thumbnail generation failed or no image uploaded.":"Thumbnail generation failed or no image uploaded."),ep(e),0===Object.keys(e).length},ev=(0,a.useCallback)(e=>{let{mainImageFiles:r,thumbnailImageFile:s}=e;console.log("[NewAccessoryForm] handleImageUploadComplete called. Data:",{mainFiles:null==r?void 0:r.length,thumbFile:null==s?void 0:s.name}),el(r||[]),ec(s),em.images&&ep(e=>({...e,images:null}))},[em.images]),ef=async e=>{if(e.preventDefault(),!eb())return void eh("Please correct the errors in the form.");ed(!0),eh(null);try{let e=null;if(en){let r=new Date().toISOString().split("T")[0].replace(/-/g,"/"),t="thumb_".concat((0,u.A)(),"_").concat(m()(en.name,{lower:!0,strict:!0})),a="accessories/".concat(r,"/").concat(t),{data:i,error:l}=await s.storage.from("cardimages").upload(a,en);if(l)throw Error("Thumbnail upload failed: ".concat(l.message));let{data:n}=s.storage.from("cardimages").getPublicUrl(a);e=n.publicUrl}else throw Error("Thumbnail is required.");let r=[];if(ei.length>0)for(let e of ei){let t=new Date().toISOString().split("T")[0].replace(/-/g,"/"),a="".concat((0,u.A)(),"_").concat(m()(e.name,{lower:!0,strict:!0})),i="accessories/".concat(t,"/").concat(a),{error:l}=await s.storage.from("cardimages").upload(i,e);if(l)throw Error("Image upload failed for ".concat(e.name,": ").concat(l.message));let{data:n}=s.storage.from("cardimages").getPublicUrl(i);r.push(n.publicUrl)}else throw Error("At least one main image is required.");let{error:t}=await s.from("accessories").insert({name:O,slug:K,description:J,category_id:Y,accessory_type:et,price:parseFloat($),stock_quantity:parseInt(er),image_urls:r,thumbnail_url:e});if(t)throw Error("Database insert failed: ".concat(t.message));G(""),Q(""),X(""),Z(""),ee(""),es(""),ea(""),el([]),ec(null),ey(e=>e+1),ex(!0),setTimeout(()=>{i.push("/dashboard/accessories")},1e3)}catch(e){console.error("Error submitting accessory:",e),eh(e.message||"An unexpected error occurred.")}finally{ed(!1)}};return(0,t.jsxs)(g.A,{sx:{maxWidth:800,mx:"auto",p:3},children:[(0,t.jsxs)(g.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,t.jsx)(l.A,{variant:"h4",component:"h1",sx:{fontWeight:700},children:"Add New Accessory"}),(0,t.jsx)(x.A,{component:F(),href:"/dashboard/accessories",variant:"outlined",startIcon:(0,t.jsx)(D.A,{}),sx:{borderRadius:2},children:"Back to Accessories"})]}),(0,t.jsx)(A.A,{elevation:0,sx:{borderRadius:2,overflow:"hidden"},children:(0,t.jsxs)(g.A,{component:"form",onSubmit:ef,sx:{p:3},children:[(0,t.jsxs)(B.N,{children:[eu&&(0,t.jsx)(R.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,t.jsx)(c.A,{severity:"error",sx:{mb:3},onClose:()=>eh(null),children:eu})}),eg&&(0,t.jsx)(R.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,t.jsx)(c.A,{severity:"success",sx:{mb:3},onClose:()=>ex(!1),children:"Accessory created successfully! Redirecting..."})})]}),(0,t.jsxs)(g.A,{sx:{mb:4},children:[(0,t.jsxs)(l.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(E.A,{color:"primary"}),"Basic Information"]}),(0,t.jsxs)(y.A,{spacing:3,children:[(0,t.jsx)(j.A,{required:!0,fullWidth:!0,id:"name",label:"Accessory Name",name:"name",value:O,onChange:e=>{let r=e.target.value;G(r),ej(r)},error:!!em.name,helperText:em.name,disabled:eo,InputProps:{startAdornment:(0,t.jsx)(b.A,{position:"start",children:(0,t.jsx)(q.A,{color:"action"})})}}),(0,t.jsx)(v.A,{title:"Auto-generated from name",arrow:!0,placement:"top",children:(0,t.jsx)(j.A,{fullWidth:!0,id:"slug",label:"Slug",name:"slug",value:K,InputProps:{readOnly:!0,startAdornment:(0,t.jsx)(b.A,{position:"start",children:(0,t.jsx)(H.A,{color:"action"})})},error:!!em.slug,helperText:em.slug,disabled:eo,sx:{"& .MuiOutlinedInput-root":{bgcolor:"dark"===h.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)"}}})}),(0,t.jsx)(j.A,{fullWidth:!0,id:"description",label:"Description",name:"description",multiline:!0,rows:4,value:J,onChange:e=>X(e.target.value),disabled:eo,InputProps:{startAdornment:(0,t.jsx)(b.A,{position:"start",sx:{alignSelf:"flex-start",mt:1.5},children:(0,t.jsx)(N.A,{color:"action"})})}})]})]}),(0,t.jsx)(f.A,{sx:{my:4}}),(0,t.jsxs)(g.A,{sx:{mb:4},children:[(0,t.jsxs)(l.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(z.A,{color:"primary"}),"Classification & Pricing"]}),(0,t.jsxs)(y.A,{spacing:3,children:[(0,t.jsxs)(C.A,{container:!0,spacing:2,children:[(0,t.jsx)(C.A,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(S.A,{fullWidth:!0,required:!0,error:!!em.categoryId,children:[(0,t.jsx)(I.A,{id:"category-label",children:"Category"}),(0,t.jsx)(w.A,{labelId:"category-label",id:"category",value:Y,label:"Category",onChange:e=>Z(e.target.value),disabled:eo,children:r.map(e=>(0,t.jsx)(k.A,{value:e.id,children:e.name},e.id))}),em.categoryId&&(0,t.jsx)(T.A,{children:em.categoryId})]})}),(0,t.jsx)(C.A,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(S.A,{fullWidth:!0,required:!0,error:!!em.accessoryType,children:[(0,t.jsx)(I.A,{id:"accessory-type-label",children:"Accessory Type"}),(0,t.jsx)(w.A,{labelId:"accessory-type-label",id:"accessoryType",value:et,label:"Accessory Type",onChange:e=>ea(e.target.value),disabled:eo,children:["Binder","Sleeve","Toploader","Grading Service","Storage Box","Display Case","Other"].map(e=>(0,t.jsx)(k.A,{value:e,children:e},e))}),em.accessoryType&&(0,t.jsx)(T.A,{children:em.accessoryType})]})})]}),(0,t.jsxs)(C.A,{container:!0,spacing:2,children:[(0,t.jsx)(C.A,{item:!0,xs:12,sm:6,children:(0,t.jsx)(j.A,{required:!0,fullWidth:!0,id:"price",label:"Price",name:"price",type:"number",inputProps:{min:0,step:.01},value:$,onChange:e=>ee(e.target.value),error:!!em.price,helperText:em.price,disabled:eo,InputProps:{startAdornment:(0,t.jsx)(b.A,{position:"start",children:(0,t.jsx)(L.A,{color:"action"})})}})}),(0,t.jsx)(C.A,{item:!0,xs:12,sm:6,children:(0,t.jsx)(j.A,{required:!0,fullWidth:!0,id:"stock",label:"Stock Quantity",name:"stock",type:"number",inputProps:{min:0,step:1},value:er,onChange:e=>es(e.target.value),error:!!em.stock,helperText:em.stock,disabled:eo,InputProps:{startAdornment:(0,t.jsx)(b.A,{position:"start",children:(0,t.jsx)(V.A,{color:"action"})})}})})]})]})]}),(0,t.jsx)(f.A,{sx:{my:4}}),(0,t.jsxs)(g.A,{sx:{mb:4},children:[(0,t.jsxs)(l.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(U.A,{color:"primary"}),"Images & Thumbnail"]}),(0,t.jsx)(c.A,{severity:"info",sx:{mb:2},children:"Upload clear images of your accessory. At least one image and a thumbnail are required."}),(0,t.jsx)(g.A,{sx:{p:3,border:"1px dashed",borderColor:em.images?h.palette.error.main:h.palette.divider,borderRadius:2,bgcolor:"dark"===h.palette.mode?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.02)",transition:"all 0.2s"},children:(0,t.jsx)(M.A,{bucketName:"cardimages",pathPrefix:"accessories",onUploadComplete:ev,resetKey:eA,targetHeight:320,targetWidth:240})}),ei.length>0&&(0,t.jsx)(P.A,{in:!0,children:(0,t.jsxs)(c.A,{severity:"success",sx:{mt:2},icon:(0,t.jsx)(W.A,{}),children:[ei.length," image(s) ready.",en?" Thumbnail is set.":' Please select a thumbnail using the "Make Thumb" button.']})}),em.images&&(0,t.jsx)(T.A,{error:!0,sx:{ml:2,mt:.5},children:em.images})]}),(0,t.jsx)(f.A,{sx:{my:3}}),(0,t.jsxs)(y.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,t.jsx)(x.A,{variant:"outlined",onClick:()=>window.history.back(),disabled:eo,children:"Cancel"}),(0,t.jsx)(x.A,{type:"submit",variant:"contained",disabled:eo,startIcon:eo?(0,t.jsx)(n.A,{size:20}):(0,t.jsx)(_.A,{}),sx:{minWidth:200,background:eo?void 0:"linear-gradient(45deg, ".concat(h.palette.primary.main," 30%, ").concat(h.palette.secondary.main," 90%)")},children:eo?"Adding Accessory...":"Add Accessory to Collection"})]})]})})]})}function K(){let[e,r]=(0,a.useState)([]),[s,d]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),m=(0,o.U)(),p=(0,a.useCallback)(async()=>{d(!0),h(null);try{let{data:e,error:s}=await m.from("categories").select("id, name").order("name",{ascending:!0});if(s)throw s;r(e||[])}catch(e){console.error("Error fetching categories:",e),h("Failed to load categories. Please try again.")}finally{d(!1)}},[m]);return(0,a.useEffect)(()=>{p()},[p]),(0,t.jsxs)(i.A,{maxWidth:"md",children:[(0,t.jsx)(l.A,{variant:"h4",component:"h1",gutterBottom:!0,sx:{mt:4,mb:4},children:"Add New Accessory"}),s&&(0,t.jsx)(n.A,{}),u&&(0,t.jsx)(c.A,{severity:"error",sx:{mb:2},children:u}),!s&&!u&&(0,t.jsx)(G,{categories:e})]})}},96040:(e,r,s)=>{"use strict";s.d(r,{A:()=>i});var t=s(57515),a=s(95155);let i=(0,t.A)((0,a.jsx)("path",{d:"M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12z"}),"Label")}},e=>{var r=r=>e(e.s=r);e.O(0,[3627,1935,4127,5158,2842,9295,4801,8449,2110,6153,6874,2330,5297,9186,259,8441,1684,7358],()=>r(62554)),_N_E=e.O()}]);