(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6990],{19401:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>_});var t=r(95155),n=r(12115),i=r(35695),a=r(55954),o=r(67217),l=r(54581),c=r(14426),d=r(92302),u=r(68534),m=r(18407),h=r(72110),x=r(31054),g=r(65604),p=r(700),A=r(41101),y=r(74964),j=r(38464),b=r(28890),f=r(30377);function _(e){var s;let{params:r}=e,{id:_}=r,k=(0,a.U)(),v=(0,i.useRouter)(),{isAdmin:I,isEditor:C}=(0,f.A)(),[w,E]=(0,n.useState)(null),[S,N]=(0,n.useState)(!0),[B,q]=(0,n.useState)(null),[D,z]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=async()=>{N(!0),q(null);try{let{data:e,error:s}=await k.from("accessories").select("\n            *,\n            categories:category_id (\n              id,\n              name\n            )\n          ").eq("id",_).single();if(s)throw s;if(!e)throw Error("Accessory not found");E(e),e.image_urls&&e.image_urls.length>0?z(e.image_urls[0]):z(e.thumbnail_url)}catch(e){console.error("Error fetching accessory:",e),q("Failed to load accessory details. Please try again.")}finally{N(!1)}};_&&e()},[_,k]);let F=()=>{v.push("/dashboard/accessories")},J=e=>{z(e)};return S?(0,t.jsx)(o.A,{maxWidth:"lg",children:(0,t.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:(0,t.jsx)(c.A,{})})}):B?(0,t.jsxs)(o.A,{maxWidth:"lg",children:[(0,t.jsx)(d.A,{severity:"error",sx:{mt:4},children:B}),(0,t.jsx)(u.A,{variant:"outlined",startIcon:(0,t.jsx)(j.A,{}),onClick:F,sx:{mt:2},children:"Back to Accessories"})]}):w?(0,t.jsxs)(o.A,{maxWidth:"lg",children:[(0,t.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:4,mb:3},children:[(0,t.jsx)(u.A,{variant:"outlined",startIcon:(0,t.jsx)(j.A,{}),onClick:F,children:"Back to Accessories"}),!S&&((null==I?void 0:I())||(null==C?void 0:C()))&&(0,t.jsx)(u.A,{variant:"contained",color:"primary",startIcon:(0,t.jsx)(b.A,{}),onClick:()=>{v.push("/dashboard/accessories/".concat(_,"/edit"))},children:"Edit Accessory"})]}),(0,t.jsx)(m.A,{elevation:2,sx:{p:3,mb:4},children:(0,t.jsxs)(h.A,{container:!0,spacing:4,children:[(0,t.jsxs)(h.A,{item:!0,xs:12,md:6,children:[(0,t.jsx)(l.A,{sx:{mb:2},children:(0,t.jsx)("img",{src:D||"/images/placeholder.png",alt:w.name,style:{width:"100%",maxHeight:"400px",objectFit:"contain",backgroundColor:"#f5f5f5",borderRadius:"4px"}})}),w.image_urls&&w.image_urls.length>1&&(0,t.jsx)(x.A,{cols:4,rowHeight:80,sx:{mt:1},children:w.image_urls.map((e,s)=>(0,t.jsx)(g.A,{onClick:()=>J(e),sx:{cursor:"pointer",border:e===D?"2px solid #2196f3":"none",borderRadius:"4px"},children:(0,t.jsx)("img",{src:e,alt:"".concat(w.name," view ").concat(s+1),loading:"lazy",style:{height:"100%",objectFit:"contain",backgroundColor:"#f5f5f5",borderRadius:"2px"}})},s))})]}),(0,t.jsxs)(h.A,{item:!0,xs:12,md:6,children:[(0,t.jsx)(p.A,{variant:"h4",component:"h1",gutterBottom:!0,children:w.name}),(0,t.jsxs)(l.A,{sx:{display:"flex",gap:1,mb:2},children:[(0,t.jsx)(A.A,{label:w.accessory_type||"Other",color:"secondary",variant:"outlined"}),w.categories&&(0,t.jsx)(A.A,{label:w.categories.name,color:"primary",variant:"outlined"})]}),(0,t.jsxs)(p.A,{variant:"h5",component:"p",color:"primary",sx:{mb:2},children:["$",null==(s=w.price)?void 0:s.toFixed(2)]}),(0,t.jsx)(A.A,{label:w.stock_quantity>0?"In Stock: ".concat(w.stock_quantity):"Out of Stock",color:w.stock_quantity>0?"success":"error",sx:{mb:3}}),(0,t.jsx)(y.A,{sx:{my:2}}),(0,t.jsx)(p.A,{variant:"h6",gutterBottom:!0,children:"Description"}),(0,t.jsx)(p.A,{variant:"body1",paragraph:!0,children:w.description||"No description provided."}),(0,t.jsx)(y.A,{sx:{my:2}}),(0,t.jsxs)(l.A,{children:[(0,t.jsxs)(p.A,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:["Product ID: ",w.id]}),(0,t.jsxs)(p.A,{variant:"subtitle2",color:"text.secondary",children:["Added: ",new Date(w.created_at).toLocaleDateString()]})]})]})]})})]}):(0,t.jsxs)(o.A,{maxWidth:"lg",children:[(0,t.jsx)(d.A,{severity:"warning",sx:{mt:4},children:"Accessory not found"}),(0,t.jsx)(u.A,{variant:"outlined",startIcon:(0,t.jsx)(j.A,{}),onClick:F,sx:{mt:2},children:"Back to Accessories"})]})}},30377:(e,s,r)=>{"use strict";r.d(s,{A:()=>a});var t=r(12115),n=r(55954);async function i(e,s,r){let{data:t,error:n}=await e.from("user_roles").select("\n      role_id,\n      roles:role_id (\n        role_permissions (\n          permission_id,\n          permissions:permission_id (\n            name\n          )\n        )\n      )\n    ").eq("user_id",s);return n?(console.error("Error checking user permission:",n),!1):t.some(e=>e.roles.role_permissions.some(e=>e.permissions.name===r))}function a(){let e=(0,n.U)(),[s,r]=(0,t.useState)(!0),[a,o]=(0,t.useState)(null),[l,c]=(0,t.useState)(null),[d,u]=(0,t.useState)([]),[m,h]=(0,t.useState)(!1);(0,t.useEffect)(()=>{let s=async()=>{try{r(!0),o(null);let{data:s,error:t}=await e.auth.getUser();if(t)throw t;let n=null==s?void 0:s.user;if(!n){u([]),c(null),r(!1),h(!0);return}c(n.id);try{let{data:s}=await e.from("user_roles").select("\n              roles:role_id (\n                id,\n                name\n              )\n            ").eq("user_id",n.id);if(s&&s.length>0)return void u(s.map(e=>e.roles).filter(Boolean))}catch(e){console.log("Falling back to simple role query",e.message)}try{let{data:s}=await e.from("user_roles").select("role").eq("user_id",n.id);if(s&&s.length>0){let e=s.map(e=>({name:e.role}));u(e);return}}catch(e){console.error("Error with simple role query:",e.message)}u([])}catch(e){console.error("Error in useRBAC:",e.message||e),u([])}finally{r(!1),h(!0)}};s();let{data:t}=e.auth.onAuthStateChange(e=>{("SIGNED_IN"===e||"SIGNED_OUT"===e||"USER_UPDATED"===e)&&s()});return()=>{t&&t.subscription&&t.subscription.unsubscribe()}},[e]);let x=(0,t.useCallback)(e=>!!m&&!s&&!!l&&!!d&&0!==d.length&&d.some(s=>s&&s.name===e),[m,s,l,d]),g=(0,t.useCallback)(async r=>{if(!m||s||!l)return!1;try{return await i(e,l,r)}catch(e){return console.error("Error checking permission:",e.message||e),!1}},[m,s,e,l]),p=(0,t.useCallback)(()=>x("admin"),[x]),A=(0,t.useCallback)(()=>x("editor")||x("admin"),[x]),y=(0,t.useCallback)(()=>x("viewer")||x("editor")||x("admin"),[x]);return{userId:l,userRoles:d,loading:s,error:a,initialized:m,checkRole:x,checkPermission:g,isAdmin:p,isEditor:A,isViewer:y}}},30985:(e,s,r)=>{Promise.resolve().then(r.bind(r,19401))},55954:(e,s,r)=>{"use strict";r.d(s,{U:()=>n});var t=r(81935);function n(){return(0,t.createBrowserClient)("https://zyqebttgsbkjarthknns.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5cWVidHRnc2JramFydGhrbm5zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgwNzkxNzcsImV4cCI6MjA2MzY1NTE3N30.o3K5QGPT-BL6y9iBnn4oaxkrD-Oed6mW3TALFk4vqJ8")}}},e=>{var s=s=>e(e.s=s);e.O(0,[1935,4127,5158,2110,1101,6762,8441,1684,7358],()=>s(30985)),_N_E=e.O()}]);