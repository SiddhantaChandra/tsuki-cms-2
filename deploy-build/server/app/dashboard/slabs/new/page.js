(()=>{var e={};e.id=5910,e.ids=[5910],e.modules={929:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var r=s(23428),a=s(60687);let i=(0,r.A)((0,a.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Grade")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},40005:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\siddh\\\\Documents\\\\tsuki-cms-2\\\\app\\\\dashboard\\\\slabs\\\\new\\\\page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\slabs\\new\\page.js","default")},53603:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>c,pages:()=>u,routeModule:()=>x,tree:()=>d});var r=s(65239),a=s(48088),i=s(88170),n=s.n(i),l=s(30893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d={children:["",{children:["dashboard",{children:["slabs",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,40005)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\slabs\\new\\page.js"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,27577)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\layout.js"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,32648)),"C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,u=["C:\\Users\\siddh\\Documents\\tsuki-cms-2\\app\\dashboard\\slabs\\new\\page.js"],c={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/dashboard/slabs/new/page",pathname:"/dashboard/slabs/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},59019:(e,t,s)=>{Promise.resolve().then(s.bind(s,97768))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},97768:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Q});var r=s(60687),a=s(43210),i=s(21360),n=s(89431),l=s(88931),o=s(68887),d=s(87088),u=s(16184),c=s(80986),x=s(69300),h=s(86862),m=s(85814),p=s.n(m),g=s(16189),b=s(2420),j=s(66803),A=s(41434),f=s(51067),v=s(25685),y=s(16393),S=s(51711),C=s(49205),w=s(23789),q=s(52260),P=s(41629),_=s(47651),I=s(91176),k=s(5294),D=s(30476),E=s(25495),G=s(85126),U=s.n(G),W=s(88920),$=s(26001),N=s(77780),F=s(79628),T=s(102),z=s(37402),L=s(12064),M=s(29041),R=s(72919),B=s(88346),J=s(71411),O=s(929);function H({initialCategories:e,loadingCategoriesExternal:t,categoryErrorExternal:s,onFormSubmitSuccess:n}){let o=(0,b.U)(),c=(0,i.A)(),[x,h]=(0,a.useState)(""),[m,g]=(0,a.useState)(""),[G,H]=(0,a.useState)(""),[X,Y]=(0,a.useState)(""),[K,Q]=(0,a.useState)(""),[V,Z]=(0,a.useState)(""),[ee,et]=(0,a.useState)("perfect"),[es,er]=(0,a.useState)("Japanese"),[ea,ei]=(0,a.useState)(""),[en,el]=(0,a.useState)(e||[]),[eo,ed]=(0,a.useState)([]),[eu,ec]=(0,a.useState)([]),[ex,eh]=(0,a.useState)([]),[em,ep]=(0,a.useState)([]),[eg,eb]=(0,a.useState)(!1),[ej,eA]=(0,a.useState)(!1),[ef,ev]=(0,a.useState)(!0),[ey,eS]=(0,a.useState)(!1),[eC,ew]=(0,a.useState)(null),[eq,eP]=(0,a.useState)(null),[e_,eI]=(0,a.useState)([]),[ek,eD]=(0,a.useState)(null),eE=(0,a.useRef)(null),eG=async e=>{if(e.preventDefault(),eS(!0),ew(null),eP(null),!x.trim()){ew("Slab Name is required."),eS(!1);return}if(0===e_.length){ew("At least one slab image is required."),eS(!1);return}if(!ek){ew('Thumbnail is required. Please use the "Make Thumb" button on one of the images.'),eS(!1);return}if(!m){ew("Category is required."),eS(!1);return}if(!G){ew("Set is required."),eS(!1);return}if(!X){ew("Subset is required."),eS(!1);return}if(!K){ew("Grading Company is required."),eS(!1);return}if(!V){ew("Grade Score is required."),eS(!1);return}if(!ee.trim()){ew("Condition is required."),eS(!1);return}if(!es.trim()){ew("Language is required."),eS(!1);return}let t=parseFloat(ea);if(isNaN(t)||t<=0){ew("Price must be a positive number."),eS(!1);return}if(s){ew("Cannot submit, categories failed to load on parent page."),eS(!1);return}try{let e=x.trim(),s=U()(e,{lower:!0,strict:!0,remove:/[*+~.()\'\"!:@]/g}),r=(0,E.A)().substring(0,8),a=`${s}-${r}`,i=[],l=null;for(let e of e_){e.name.substring(0,e.name.lastIndexOf(".")||e.name.length);let t=new Date,s=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0"),n=`slabs/${s}/${r}/${a}/${(0,E.A)()}.webp`,{error:l}=await o.storage.from("slabimages").upload(n,e,{contentType:e.type,upsert:!1});if(l)throw Error("Failed to upload main image "+e.name+": "+l.message);let{data:{publicUrl:d}}=o.storage.from("slabimages").getPublicUrl(n);i.push(d)}if(ek){ek.name.substring(0,ek.name.lastIndexOf(".")||ek.name.length);let e=new Date,t=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),a=`slabs/${t}/${s}/${r}/${(0,E.A)()}_thumb.webp`,{error:i}=await o.storage.from("slabimages").upload(a,ek,{contentType:ek.type,upsert:!1});if(i)throw Error("Failed to upload thumbnail "+ek.name+": "+i.message);let{data:{publicUrl:n}}=o.storage.from("slabimages").getPublicUrl(a);l=n}let d={name:e,slug:a,image_urls:i,thumbnail_url:l,category_id:m,set_id:G,subset_id:X,grade_company_id:K,grade_score:parseFloat(V),condition:ee.trim(),language:es.trim(),price:t},{error:u}=await o.from("slabs").insert(d);if(u)throw Error("Failed to insert slab: "+u.message);eP("Slab added successfully!"),h(""),g(""),H(""),Y(""),Q(""),Z(""),et("perfect"),er("Japanese"),ei(""),eI([]),eD(null),eE.current&&eE.current.reset&&eE.current.reset(),n&&n()}catch(e){ew("Operation failed: "+e.message),console.error("Submit Error Details:",e)}finally{eS(!1)}};return t?(0,r.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,r.jsx)(j.A,{}),(0,r.jsx)(d.A,{sx:{mt:2},children:"Loading category data from parent..."})]}):s?(0,r.jsx)(A.A,{severity:"error",sx:{mb:3,mt:2},children:"string"==typeof s?s:"Error loading categories from parent."}):(0,r.jsxs)(l.A,{sx:{maxWidth:800,mx:"auto",p:3},children:[(0,r.jsxs)(l.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,r.jsx)(d.A,{variant:"h4",component:"h1",sx:{fontWeight:700},children:"Add New Slab"}),(0,r.jsx)(u.A,{component:p(),href:"/dashboard/slabs",variant:"outlined",startIcon:(0,r.jsx)(L.A,{}),sx:{borderRadius:2},children:"Back to Slabs"})]}),t&&(0,r.jsxs)(l.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,r.jsx)(j.A,{}),(0,r.jsx)(d.A,{sx:{mt:2},children:"Loading category data from parent..."})]}),s&&(0,r.jsx)(A.A,{severity:"error",sx:{mb:3,mt:2},children:"string"==typeof s?s:"Error loading categories from parent."}),!t&&!s&&(0,r.jsx)(f.A,{elevation:0,sx:{borderRadius:2,overflow:"hidden"},children:(0,r.jsxs)(l.A,{component:"form",onSubmit:eG,sx:{p:3},children:[(0,r.jsxs)(W.N,{children:[eC&&(0,r.jsx)($.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,r.jsx)(A.A,{severity:"error",sx:{mb:3},onClose:()=>ew(null),children:eC})}),eq&&(0,r.jsx)($.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,r.jsx)(A.A,{severity:"success",sx:{mb:3},onClose:()=>eP(null),children:eq})})]}),(0,r.jsxs)(l.A,{sx:{mb:4},children:[(0,r.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(N.A,{color:"primary"}),"Basic Information"]}),(0,r.jsxs)(v.A,{spacing:3,children:[(0,r.jsx)(y.A,{fullWidth:!0,label:"Slab Name",value:x,onChange:e=>h(e.target.value),required:!0,InputProps:{startAdornment:(0,r.jsx)(S.A,{position:"start",children:(0,r.jsx)(R.A,{color:"action"})})}}),(0,r.jsxs)(C.A,{container:!0,spacing:2,children:[(0,r.jsx)(C.A,{item:!0,xs:12,sm:6,children:(0,r.jsx)(y.A,{fullWidth:!0,label:"Price",type:"number",value:ea,onChange:e=>ei(e.target.value),InputProps:{inputProps:{min:0,step:"0.01"},startAdornment:(0,r.jsx)(S.A,{position:"start",children:(0,r.jsx)(z.A,{color:"action"})})},required:!0})}),(0,r.jsx)(C.A,{item:!0,xs:12,sm:6,children:(0,r.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,r.jsx)(q.A,{children:"Language"}),(0,r.jsxs)(P.A,{value:es,label:"Language",onChange:e=>er(e.target.value),startAdornment:(0,r.jsx)(S.A,{position:"start",children:(0,r.jsx)(B.A,{color:"action"})}),children:[(0,r.jsx)(_.A,{value:"Japanese",children:"Japanese"}),(0,r.jsx)(_.A,{value:"English",children:"English"})]})]})})]}),(0,r.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,r.jsx)(q.A,{children:"Condition"}),(0,r.jsxs)(P.A,{value:ee,label:"Condition",onChange:e=>et(e.target.value),children:[(0,r.jsx)(_.A,{value:"perfect",children:"Perfect"}),(0,r.jsx)(_.A,{value:"scratched",children:"Scratched"}),(0,r.jsx)(_.A,{value:"damaged",children:"Damaged"})]})]})]})]}),(0,r.jsx)(I.A,{sx:{my:4}}),(0,r.jsxs)(l.A,{sx:{mb:4},children:[(0,r.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(O.A,{color:"primary"}),"Grading Information"]}),(0,r.jsxs)(v.A,{spacing:3,children:[(0,r.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:ef,children:[(0,r.jsx)(q.A,{children:"Grading Company"}),(0,r.jsxs)(P.A,{value:K,label:"Grading Company",onChange:e=>Q(e.target.value),children:[(0,r.jsx)(_.A,{value:"",children:(0,r.jsx)("em",{children:"Select Grading Company"})}),ex.map(e=>(0,r.jsx)(_.A,{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!K||0===em.length,children:[(0,r.jsx)(q.A,{children:"Grade Score"}),(0,r.jsxs)(P.A,{value:V,label:"Grade Score",onChange:e=>Z(e.target.value),children:[(0,r.jsx)(_.A,{value:"",children:(0,r.jsx)("em",{children:"Select Grade Score"})}),em.map(e=>(0,r.jsx)(_.A,{value:e,children:e},e))]})]})]})]}),(0,r.jsx)(I.A,{sx:{my:4}}),(0,r.jsxs)(l.A,{sx:{mb:4},children:[(0,r.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(F.A,{color:"primary"}),"Classification"]}),(0,r.jsxs)(v.A,{spacing:3,children:[(0,r.jsxs)(w.A,{fullWidth:!0,required:!0,children:[(0,r.jsx)(q.A,{children:"Category"}),(0,r.jsxs)(P.A,{value:m,label:"Category",onChange:e=>g(e.target.value),children:[(0,r.jsx)(_.A,{value:"",children:(0,r.jsx)("em",{children:"Select Category"})}),en.map(e=>(0,r.jsx)(_.A,{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!m,children:[(0,r.jsx)(q.A,{children:"Set"}),(0,r.jsxs)(P.A,{value:G,label:"Set",onChange:e=>H(e.target.value),children:[(0,r.jsx)(_.A,{value:"",children:(0,r.jsx)("em",{children:"Select Set"})}),eo.map(e=>(0,r.jsx)(_.A,{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)(w.A,{fullWidth:!0,required:!0,disabled:!G,children:[(0,r.jsx)(q.A,{children:"Subset"}),(0,r.jsxs)(P.A,{value:X,label:"Subset",onChange:e=>Y(e.target.value),children:[(0,r.jsx)(_.A,{value:"",children:(0,r.jsx)("em",{children:"Select Subset"})}),eu.map(e=>(0,r.jsxs)(_.A,{value:e.id,children:[e.name," - ",e.slug]},e.id))]})]})]})]}),(0,r.jsx)(I.A,{sx:{my:4}}),(0,r.jsxs)(l.A,{sx:{mb:4},children:[(0,r.jsxs)(d.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(J.A,{color:"primary"}),"Images & Thumbnail"]}),(0,r.jsx)(A.A,{severity:"info",sx:{mb:2},children:"Upload clear images of your slab. At least one image and a thumbnail are required."}),(0,r.jsx)(D.A,{bucketName:"slabimages",pathPrefix:"slabs",onUploadComplete:e=>{let{mainImageFiles:t,thumbnailImageFile:s}=e;eI(t||[]),eD(s||null),console.log("Image upload complete:",{mainCount:t?.length||0,hasThumbnail:!!s})},ref:eE}),e_.length>0&&(0,r.jsx)(k.A,{in:!0,children:(0,r.jsxs)(A.A,{severity:"success",sx:{mt:2},icon:(0,r.jsx)(T.A,{}),children:[e_.length," image(s) ready.",ek?" Thumbnail is set.":' Please select a thumbnail using the "Make Thumb" button.']})})]}),(0,r.jsx)(I.A,{sx:{my:3}}),(0,r.jsxs)(v.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,r.jsx)(u.A,{variant:"outlined",onClick:()=>window.history.back(),disabled:ey,children:"Cancel"}),(0,r.jsx)(u.A,{type:"submit",variant:"contained",disabled:ey,startIcon:ey?(0,r.jsx)(j.A,{size:20}):(0,r.jsx)(M.A,{}),sx:{minWidth:200,background:ey?void 0:`linear-gradient(45deg, ${c.palette.primary.main} 30%, ${c.palette.secondary.main} 90%)`},children:ey?"Adding Slab...":"Add Slab to Collection"})]})]})})]})}var X=s(21001),Y=s(31267),K=s(94035);function Q(){let e=(0,g.useRouter)();(0,b.U)();let t=(0,i.A)(),[s,m]=(0,a.useState)([]),[j,A]=(0,a.useState)(!0),[f,v]=(0,a.useState)(null);return(0,r.jsxs)(n.A,{maxWidth:"lg",sx:{py:4},children:[(0,r.jsx)(l.A,{sx:{mb:3},children:(0,r.jsxs)(o.A,{"aria-label":"breadcrumb",children:[(0,r.jsxs)(p(),{href:"/dashboard",passHref:!0,style:{color:t.palette.text.primary,textDecoration:"none",display:"flex",alignItems:"center"},children:[(0,r.jsx)(Y.A,{sx:{mr:.5},fontSize:"small"}),"Dashboard"]}),(0,r.jsxs)(p(),{href:"/dashboard/slabs",passHref:!0,style:{color:t.palette.text.primary,textDecoration:"none",display:"flex",alignItems:"center"},children:[(0,r.jsx)(K.A,{sx:{mr:.5},fontSize:"small"}),"Slabs"]}),(0,r.jsxs)(d.A,{color:"text.primary",sx:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(X.A,{sx:{mr:.5},fontSize:"small"}),"Add New Slab"]})]})}),(0,r.jsxs)(l.A,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},mb:3},children:[(0,r.jsx)(d.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Add New Slab"}),(0,r.jsx)(u.A,{startIcon:(0,r.jsx)(L.A,{}),variant:"outlined",onClick:()=>e.push("/dashboard/slabs"),sx:{mb:{xs:2,sm:0}},children:"Back to Collection"})]}),(0,r.jsx)(c.A,{elevation:3,sx:{overflow:"visible",borderRadius:2,boxShadow:e=>`0 8px 32px ${(0,x.X4)(e.palette.primary.main,.1)}`},children:(0,r.jsx)(h.A,{sx:{p:{xs:2,sm:3,md:4}},children:(0,r.jsx)(H,{initialCategories:s,loadingCategoriesExternal:j,categoryErrorExternal:f,onFormSubmitSuccess:()=>{console.log("NewSlabForm submitted successfully from page")}})})})]})}},98771:(e,t,s)=>{Promise.resolve().then(s.bind(s,40005))}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[4447,1103,1658,4468,2153,4112,8164,8102,6393,9205,5814,8743,8064,822,3156,476],()=>s(53603));module.exports=r})();