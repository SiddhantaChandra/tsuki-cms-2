(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4488],{7304:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(57515),s=a(95155);let l=(0,r.A)((0,s.jsx)("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder")},10005:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(57515),s=a(95155);let l=(0,r.A)((0,s.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Grade")},19505:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(57515),s=a(95155);let l=(0,r.A)((0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete")},52837:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>$});var r=a(95155),s=a(12115),l=a(67217),i=a(54581),n=a(700),o=a(68534),d=a(14426),c=a(92302),u=a(18407),h=a(6874),g=a.n(h),m=a(35695),x=a(38464),p=a(55954),b=a(16324),f=a(71803),j=a(78449),A=a(33989),v=a(72110),y=a(27088),S=a(17348),w=a(68104),C=a(76380),_=a(74964),E=a(35297),q=a(3127),k=a(14962),I=a(16460),z=a(82330),W=a(15760),D=a(51368),F=a(96262),L=a.n(F),P=a(68558),M=a(7304),G=a(19505),H=a(51935);let N=(0,a(57515).A)((0,r.jsx)("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2z"}),"Crop");var R=a(66506);a(67994);var U=a(31802),B=a(60760),T=a(76408),O=a(80946),Y=a(88806),Z=a(46108),J=a(91058),V=a(57773),K=a(52671),Q=a(10005);function X(e){var t,a;let{initialSlab:l,initialCategories:h,loadingCategoriesExternal:m,categoryErrorExternal:F,onFormSubmitSuccess:X}=e,$=(0,p.U)(),ee=(0,b.A)(),[et,ea]=(0,s.useState)((null==l?void 0:l.name)||""),[er,es]=(0,s.useState)((null==l?void 0:l.slug)||""),[el,ei]=(0,s.useState)((null==l?void 0:l.category_id)||""),[en,eo]=(0,s.useState)((null==l?void 0:l.set_id)||""),[ed,ec]=(0,s.useState)((null==l?void 0:l.subset_id)||""),[eu,eh]=(0,s.useState)((null==l?void 0:l.grade_company_id)||""),[eg,em]=(0,s.useState)((null==l||null==(t=l.grade_score)?void 0:t.toString())||""),[ex,ep]=(0,s.useState)((null==l?void 0:l.condition)||"perfect"),[eb,ef]=(0,s.useState)((null==l?void 0:l.language)||"Japanese"),[ej,eA]=(0,s.useState)((null==l||null==(a=l.price)?void 0:a.toString())||""),[ev,ey]=(0,s.useState)(h||[]),[eS,ew]=(0,s.useState)([]),[eC,e_]=(0,s.useState)([]),[eE,eq]=(0,s.useState)([]),[ek,eI]=(0,s.useState)([]),[ez,eW]=(0,s.useState)(!1),[eD,eF]=(0,s.useState)(!1),[eL,eP]=(0,s.useState)(!0),[eM,eG]=(0,s.useState)(!1),[eH,eN]=(0,s.useState)(null),[eR,eU]=(0,s.useState)(null),[eB,eT]=(0,s.useState)((null==l?void 0:l.image_urls)||[]),[eO,eY]=(0,s.useState)((null==l?void 0:l.thumbnail_url)||null),[eZ,eJ]=(0,s.useState)([]),[eV,eK]=(0,s.useState)(null),[eQ,eX]=(0,s.useState)(!1),[e$,e0]=(0,s.useState)(!1),[e1,e2]=(0,s.useState)([]),[e5,e4]=(0,s.useState)(null),[e7,e3]=(0,s.useState)(!1),[e8,e9]=(0,s.useState)(1),[e6,te]=(0,s.useState)(.1),[tt,ta]=(0,s.useState)(3),tr=(0,s.useRef)(null),[ts,tl]=(0,s.useState)(null);(0,s.useEffect)(()=>{ey(h||[])},[h]),(0,s.useEffect)(()=>{(async()=>{eP(!0);let{data:e,error:t}=await $.from("grade_companies").select("id, name, grades");t?(eN("Failed to load grading companies: "+t.message),eq([])):eq(e||[]),eP(!1)})()},[$]),(0,s.useEffect)(()=>{el?(async()=>{eW(!0),(el!==(null==l?void 0:l.category_id)||en!==(null==l?void 0:l.set_id))&&(ew([]),eo(""),e_([]),ec(""));let{data:e,error:t}=await $.from("sets").select("id, name").eq("category_id",el);t?eN("Failed to load sets: "+t.message):ew(e||[]),eW(!1)})():(ew([]),eo(""),e_([]),ec(""))},[el,$,null==l?void 0:l.category_id,null==l?void 0:l.set_id,en]),(0,s.useEffect)(()=>{en?(async()=>{if(en)try{eF(!0),(en!==(null==l?void 0:l.set_id)||ed!==(null==l?void 0:l.subset_id))&&(e_([]),ec(""));let{data:e,error:t}=await $.from("subsets").select("id, name, slug, release_date").eq("set_id",en);if(t)throw t;if(e){let t=[...e].sort((e,t)=>e.release_date&&t.release_date?new Date(t.release_date)-new Date(e.release_date):e.release_date?-1:1*!!t.release_date);e_(t)}}catch(e){console.error("Error fetching subsets:",e.message)}finally{eF(!1)}})():(e_([]),ec(""))},[en,$,null==l?void 0:l.set_id,ed,null==l?void 0:l.subset_id]),(0,s.useEffect)(()=>{if(eu){let e=eE.find(e=>e.id===eu);eI(e&&e.grades||[]),eg||em("")}else eI([]),em("")},[eu,eE,eg]),(0,s.useEffect)(()=>{(async()=>{if(l&&ev.length>0){if(l.category_id&&!eS.length)try{eW(!0);let{data:e,error:t}=await $.from("sets").select("id, name").eq("category_id",l.category_id);if(t)throw t;ew(e||[])}catch(e){console.error("Error loading initial sets:",e)}finally{eW(!1)}if(l.set_id&&!eC.length)try{eF(!0);let{data:e,error:t}=await $.from("subsets").select("id, name, slug, release_date").eq("set_id",l.set_id);if(t)throw t;if(e){let t=[...e].sort((e,t)=>e.release_date&&t.release_date?new Date(t.release_date)-new Date(e.release_date):e.release_date?-1:1*!!t.release_date);e_(t)}}catch(e){console.error("Error loading initial subsets:",e)}finally{eF(!1)}}})()},[l,ev,$,eS.length,eC.length]);let ti=e=>{eT(t=>t.filter(t=>t!==e)),e2(t=>[...t,e]),e===eO&&eY(null)},tn=e=>{eY(e)},to=(e,t)=>{e4(e),tl(t),e3(!0)},td=()=>{e3(!1),e4(null),tl(null)},tc=async()=>{if(tr.current&&null!==ts){eG(!0);try{let e=tr.current.getCanvas();if(!e)throw Error("Failed to get cropped canvas");let t=await new Promise(t=>{e.toBlob(t,"image/webp",.8)});if(!t)throw Error("Failed to create blob from canvas");let a=await (0,U.A)(t,{maxSizeMB:1,maxWidthOrHeight:1024,useWebWorker:!0}),r=new Date,s=r.getFullYear(),l=(r.getMonth()+1).toString().padStart(2,"0"),i=r.getDate().toString().padStart(2,"0"),n="slabs/".concat(s,"/").concat(l,"/").concat(i,"/").concat((0,D.A)(),"_cropped.webp"),{error:o}=await $.storage.from("slabimages").upload(n,a,{contentType:"image/webp",upsert:!1});if(o)throw o;let{data:{publicUrl:d}}=$.storage.from("slabimages").getPublicUrl(n),c=eB[ts];eT(e=>{let t=[...e];return t[ts]=d,t}),c===eO&&eY(d),e2(e=>[...e,c]),eU("Image cropped successfully!"),td()}catch(e){console.error("Crop error:",e),eN("Failed to crop image: "+e.message)}finally{eG(!1)}}},tu=async e=>{e.preventDefault(),eG(!0),eN(null),eU(null);try{if(!et.trim())throw Error("Slab Name is required.");if(!el)throw Error("Category is required.");if(!en)throw Error("Set is required.");if(!ed)throw Error("Subset is required.");if(!eu)throw Error("Grading Company is required.");if(!eg)throw Error("Grade Score is required.");if(!ex.trim())throw Error("Condition is required.");if(!eb.trim())throw Error("Language is required.");let e=parseFloat(ej);if(isNaN(e)||e<=0)throw Error("Price must be a positive number.");if(0===eB.length&&0===eZ.length)throw Error("At least one slab image is required.");if(!eO&&!eV)throw Error("Thumbnail is required.");let t=et.trim(),a=L()(t,{lower:!0,strict:!0,remove:/[*+~.()\'\"!:@]/g}),r=(0,D.A)().substring(0,8),s=er||"".concat(a,"-").concat(r),i=[...eB],n=eO;if(eZ.length>0)for(let e of eZ){let t=new Date,a=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),l="slabs/".concat(a,"/").concat(r,"/").concat(s,"/").concat((0,D.A)(),".webp"),{error:n}=await $.storage.from("slabimages").upload(l,e,{contentType:e.type,upsert:!1});if(n)throw Error("Failed to upload main image: "+n.message);let{data:{publicUrl:o}}=$.storage.from("slabimages").getPublicUrl(l);i.push(o)}if(eV){let e=new Date,t=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),s="slabs/".concat(t,"/").concat(a,"/").concat(r,"/").concat((0,D.A)(),"_thumb.webp"),{error:l}=await $.storage.from("slabimages").upload(s,eV,{contentType:eV.type,upsert:!1});if(l)throw Error("Failed to upload thumbnail: "+l.message);let{data:{publicUrl:i}}=$.storage.from("slabimages").getPublicUrl(s);n=i}let o={name:t,slug:s,image_urls:i,thumbnail_url:n,category_id:el,set_id:en,subset_id:ed,grade_company_id:eu,grade_score:parseFloat(eg),condition:ex.trim(),language:eb.trim(),price:e},{error:d}=await $.from("slabs").update(o).eq("id",l.id);if(d)throw Error("Failed to update slab: "+d.message);if(e1.length>0)for(let e of e1)try{let t=new URL(e).pathname.split("/").slice(-4).join("/");await $.storage.from("slabimages").remove([t])}catch(e){console.warn("Failed to delete old image:",e)}eU("Slab updated successfully!"),eJ([]),eK(null),eX(!1),e0(!1),e2([]),X&&X()}catch(e){eN(e.message),console.error("Submit Error Details:",e)}finally{eG(!1)}};return m?(0,r.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,r.jsx)(d.A,{}),(0,r.jsx)(n.A,{sx:{mt:2},children:"Loading category data from parent..."})]}):F?(0,r.jsx)(c.A,{severity:"error",sx:{mb:3,mt:2},children:"string"==typeof F?F:"Error loading categories from parent."}):(0,r.jsxs)(i.A,{sx:{maxWidth:900,mx:"auto",p:3},children:[(0,r.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[(0,r.jsx)(n.A,{variant:"h4",component:"h1",sx:{fontWeight:700},children:"Edit Slab"}),(0,r.jsx)(o.A,{component:g(),href:"/dashboard/slabs",variant:"outlined",startIcon:(0,r.jsx)(x.A,{}),sx:{borderRadius:2},children:"Back to Slabs"})]}),m&&(0,r.jsxs)(i.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",py:5},children:[(0,r.jsx)(d.A,{}),(0,r.jsx)(n.A,{sx:{mt:2},children:"Loading category data from parent..."})]}),F&&(0,r.jsx)(c.A,{severity:"error",sx:{mb:3,mt:2},children:"string"==typeof F?F:"Error loading categories from parent."}),!m&&!F&&(0,r.jsx)(u.A,{elevation:0,sx:{borderRadius:2,overflow:"hidden"},children:(0,r.jsxs)(i.A,{component:"form",onSubmit:tu,sx:{p:3},children:[(0,r.jsxs)(B.N,{children:[eH&&(0,r.jsx)(T.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,r.jsx)(c.A,{severity:"error",sx:{mb:3},onClose:()=>eN(null),children:eH})}),eR&&(0,r.jsx)(T.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:(0,r.jsx)(c.A,{severity:"success",sx:{mb:3},onClose:()=>eU(null),children:eR})})]}),(0,r.jsxs)(i.A,{sx:{mb:4},children:[(0,r.jsxs)(n.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(O.A,{color:"primary"}),"Basic Information"]}),(0,r.jsxs)(f.A,{spacing:3,children:[(0,r.jsx)(j.A,{fullWidth:!0,label:"Slab Name",value:et,onChange:e=>ea(e.target.value),required:!0,InputProps:{startAdornment:(0,r.jsx)(A.A,{position:"start",children:(0,r.jsx)(V.A,{color:"action"})})}}),(0,r.jsxs)(v.A,{container:!0,spacing:2,children:[(0,r.jsx)(v.A,{item:!0,xs:12,sm:6,children:(0,r.jsx)(j.A,{fullWidth:!0,label:"Price",type:"number",value:ej,onChange:e=>eA(e.target.value),InputProps:{inputProps:{min:0,step:"0.01"},startAdornment:(0,r.jsx)(A.A,{position:"start",children:(0,r.jsx)(J.A,{color:"action"})})},required:!0})}),(0,r.jsx)(v.A,{item:!0,xs:12,sm:6,children:(0,r.jsxs)(y.A,{fullWidth:!0,required:!0,children:[(0,r.jsx)(S.A,{children:"Language"}),(0,r.jsxs)(w.A,{value:eb,label:"Language",onChange:e=>ef(e.target.value),children:[(0,r.jsx)(C.A,{value:"Japanese",children:"Japanese"}),(0,r.jsx)(C.A,{value:"English",children:"English"})]})]})})]}),(0,r.jsxs)(y.A,{fullWidth:!0,required:!0,children:[(0,r.jsx)(S.A,{children:"Condition"}),(0,r.jsxs)(w.A,{value:ex,label:"Condition",onChange:e=>ep(e.target.value),children:[(0,r.jsx)(C.A,{value:"perfect",children:"Perfect"}),(0,r.jsx)(C.A,{value:"scratched",children:"Scratched"}),(0,r.jsx)(C.A,{value:"damaged",children:"Damaged"})]})]})]})]}),(0,r.jsx)(_.A,{sx:{my:4}}),(0,r.jsxs)(i.A,{sx:{mb:4},children:[(0,r.jsxs)(n.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(Q.A,{color:"primary"}),"Grading Information"]}),(0,r.jsxs)(f.A,{spacing:3,children:[(0,r.jsxs)(y.A,{fullWidth:!0,required:!0,disabled:eL,children:[(0,r.jsx)(S.A,{children:"Grading Company"}),(0,r.jsxs)(w.A,{value:eu,label:"Grading Company",onChange:e=>eh(e.target.value),children:[(0,r.jsx)(C.A,{value:"",children:(0,r.jsx)("em",{children:"Select Grading Company"})}),eE.map(e=>(0,r.jsx)(C.A,{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)(y.A,{fullWidth:!0,required:!0,disabled:!eu||0===ek.length,children:[(0,r.jsx)(S.A,{children:"Grade Score"}),(0,r.jsxs)(w.A,{value:eg,label:"Grade Score",onChange:e=>em(e.target.value),children:[(0,r.jsx)(C.A,{value:"",children:(0,r.jsx)("em",{children:"Select Grade Score"})}),ek.map(e=>(0,r.jsx)(C.A,{value:e,children:e},e))]})]})]})]}),(0,r.jsx)(_.A,{sx:{my:4}}),(0,r.jsxs)(i.A,{sx:{mb:4},children:[(0,r.jsxs)(n.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(Y.A,{color:"primary"}),"Classification"]}),(0,r.jsxs)(f.A,{spacing:3,children:[(0,r.jsxs)(y.A,{fullWidth:!0,required:!0,children:[(0,r.jsx)(S.A,{children:"Category"}),(0,r.jsxs)(w.A,{value:el,label:"Category",onChange:e=>ei(e.target.value),children:[(0,r.jsx)(C.A,{value:"",children:(0,r.jsx)("em",{children:"Select Category"})}),ev.map(e=>(0,r.jsx)(C.A,{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)(y.A,{fullWidth:!0,required:!0,disabled:!el,children:[(0,r.jsx)(S.A,{children:"Set"}),(0,r.jsxs)(w.A,{value:en,label:"Set",onChange:e=>eo(e.target.value),children:[(0,r.jsx)(C.A,{value:"",children:(0,r.jsx)("em",{children:"Select Set"})}),eS.map(e=>(0,r.jsx)(C.A,{value:e.id,children:e.name},e.id))]})]}),(0,r.jsxs)(y.A,{fullWidth:!0,required:!0,disabled:!en,children:[(0,r.jsx)(S.A,{children:"Subset"}),(0,r.jsxs)(w.A,{value:ed,label:"Subset",onChange:e=>ec(e.target.value),children:[(0,r.jsx)(C.A,{value:"",children:(0,r.jsx)("em",{children:"Select Subset"})}),eC.map(e=>(0,r.jsxs)(C.A,{value:e.id,children:[e.name," - ",e.slug]},e.id))]})]})]})]}),(0,r.jsx)(_.A,{sx:{my:4}}),(0,r.jsxs)(i.A,{sx:{mb:4},children:[(0,r.jsxs)(n.A,{variant:"h6",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(K.A,{color:"primary"}),"Images & Thumbnail"]}),eB.length>0&&(0,r.jsxs)(i.A,{sx:{mb:3},children:[(0,r.jsx)(n.A,{variant:"subtitle1",sx:{mb:2,fontWeight:500},children:"Current Images:"}),(0,r.jsx)(i.A,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:eB.map((e,t)=>(0,r.jsxs)(i.A,{sx:{position:"relative",width:120,height:168,borderRadius:2,overflow:"hidden",boxShadow:3},children:[(0,r.jsx)("img",{src:e,alt:"Slab image ".concat(t+1),style:{width:"100%",height:"100%",objectFit:"contain",border:e===eO?"2px solid #f9a825":"none",backgroundColor:"rgba(0,0,0,0.04)"}}),(0,r.jsxs)(i.A,{sx:{position:"absolute",bottom:0,left:0,right:0,display:"flex",justifyContent:"space-between",p:.75,background:"linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0) 100%)"},children:[(0,r.jsx)(E.A,{title:e===eO?"Current thumbnail":"Set as thumbnail",children:(0,r.jsx)(q.A,{size:"small",onClick:()=>tn(e),sx:{backgroundColor:e===eO?"rgba(249, 168, 37, 0.7)":"rgba(0,0,0,0.5)",color:"#fff","&:hover":{backgroundColor:e===eO?"rgba(249, 168, 37, 0.9)":"rgba(0,0,0,0.7)"}},children:e===eO?(0,r.jsx)(P.A,{}):(0,r.jsx)(M.A,{})})}),(0,r.jsxs)(i.A,{sx:{display:"flex",gap:.5},children:[(0,r.jsx)(E.A,{title:"Crop image",children:(0,r.jsx)(q.A,{size:"small",onClick:()=>to(e,t),sx:{backgroundColor:"rgba(0,0,0,0.5)",color:"#fff","&:hover":{backgroundColor:"rgba(0,0,0,0.7)"}},children:(0,r.jsx)(N,{})})}),(0,r.jsx)(E.A,{title:"Remove image",children:(0,r.jsx)(q.A,{size:"small",onClick:()=>ti(e),sx:{backgroundColor:"rgba(220,0,0,0.5)",color:"#fff","&:hover":{backgroundColor:"rgba(220,0,0,0.7)"}},children:(0,r.jsx)(G.A,{})})})]})]})]},t))})]}),(0,r.jsx)(c.A,{severity:"info",sx:{mb:2},children:"Upload new images to replace or add to the current ones (optional)"}),(0,r.jsx)(W.A,{bucketName:"slabimages",pathPrefix:"slabs",onUploadComplete:e=>{let{mainImageFiles:t,thumbnailImageFile:a}=e;eJ(t||[]),eK(a||null),eX((t||[]).length>0),e0(!!a),console.log("Image upload complete:",{mainCount:(null==t?void 0:t.length)||0,hasThumbnail:!!a})},targetHeight:320,targetWidth:240}),eZ.length>0&&(0,r.jsx)(k.A,{in:!0,children:(0,r.jsxs)(c.A,{severity:"success",sx:{mt:2},icon:(0,r.jsx)(Z.A,{}),children:[eZ.length," new image(s) ready to upload."]})})]}),(0,r.jsx)(_.A,{sx:{my:3}}),(0,r.jsxs)(f.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,r.jsx)(o.A,{variant:"outlined",onClick:()=>window.history.back(),disabled:eM,children:"Cancel"}),(0,r.jsx)(o.A,{type:"submit",variant:"contained",disabled:eM,startIcon:eM?(0,r.jsx)(d.A,{size:20}):(0,r.jsx)(H.A,{}),sx:{minWidth:200,background:eM?void 0:"linear-gradient(45deg, ".concat(ee.palette.primary.main," 30%, ").concat(ee.palette.secondary.main," 90%)")},children:eM?"Saving Changes...":"Save Changes"})]})]})}),(0,r.jsx)(I.A,{open:e7,onClose:td,"aria-labelledby":"crop-image-modal","aria-describedby":"modal-to-crop-card-image",children:(0,r.jsxs)(i.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"90%",maxWidth:700,bgcolor:"background.paper",borderRadius:"12px",boxShadow:24,p:4,display:"flex",flexDirection:"column",alignItems:"center",maxHeight:"95vh",overflowY:"auto"},children:[(0,r.jsx)(n.A,{id:"crop-image-modal",variant:"h6",component:"h2",sx:{mb:2},children:"Crop Image"}),(0,r.jsx)(i.A,{sx:{width:"100%",height:400,mb:2},children:e5&&(0,r.jsx)(R.IOb,{ref:tr,src:e5,className:"cropper",stencilProps:{aspectRatio:3/4},stencilComponent:R.c2r,defaultSize:{width:"95%",height:"95%"},zoom:e8,minZoom:e6,maxZoom:tt})}),(0,r.jsxs)(i.A,{sx:{width:"100%",mb:3},children:[(0,r.jsx)(n.A,{id:"zoom-slider",gutterBottom:!0,children:"Zoom"}),(0,r.jsx)(z.Ay,{value:e8,onChange:(e,t)=>{e9(t),tr.current&&tr.current.setZoom(t)},"aria-labelledby":"zoom-slider",valueLabelDisplay:"auto",step:.1,marks:!0,min:e6,max:tt})]}),(0,r.jsxs)(i.A,{sx:{display:"flex",gap:2},children:[(0,r.jsx)(o.A,{variant:"outlined",onClick:td,disabled:eM,children:"Cancel"}),(0,r.jsx)(o.A,{variant:"contained",onClick:tc,disabled:eM,startIcon:eM?(0,r.jsx)(d.A,{size:20}):(0,r.jsx)(N,{}),children:eM?"Saving...":"Save Crop"})]})]})})]})}function $(){let e=(0,m.useRouter)(),t=(0,m.useParams)().id,a=(0,p.U)(),[h,b]=(0,s.useState)(null),[f,j]=(0,s.useState)([]),[A,v]=(0,s.useState)(!0),[y,S]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{v(!0);try{var e,r,s,l;let{data:i,error:n}=await a.from("slabs").select("*").eq("id",t).single();if(n)throw Error("Failed to fetch slab: ".concat(n.message));if(!i)throw Error("Slab not found");let o={...i,image_urls:i.image_urls||[],thumbnail_url:i.thumbnail_url||null};b(o);let[d,c,u,h]=await Promise.all([a.from("categories").select("*"),a.from("sets").select("*").eq("category_id",i.category_id),a.from("subsets").select("*").eq("set_id",i.set_id),a.from("grade_companies").select("*")]);if(d.error)throw Error("Failed to fetch categories: ".concat(d.error.message));j(d.data||[]),console.log("Edit Slab Data:",{slab:o,categories:null==(e=d.data)?void 0:e.length,sets:null==(r=c.data)?void 0:r.length,subsets:null==(s=u.data)?void 0:s.length,gradeCompanies:null==(l=h.data)?void 0:l.length})}catch(e){console.error("Error loading data:",e),S(e.message)}finally{v(!1)}})()},[t,a]),(0,r.jsxs)(l.A,{maxWidth:"lg",sx:{py:4},children:[(0,r.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,r.jsx)(n.A,{variant:"h4",component:"h1",children:"Edit Slab"}),(0,r.jsx)(o.A,{component:g(),href:"/dashboard/slabs",variant:"outlined",startIcon:(0,r.jsx)(x.A,{}),children:"Back to Slabs"})]}),A?(0,r.jsx)(i.A,{sx:{display:"flex",justifyContent:"center",py:5},children:(0,r.jsx)(d.A,{})}):y?(0,r.jsx)(c.A,{severity:"error",sx:{mb:4},children:y}):(0,r.jsx)(u.A,{sx:{p:3},children:(0,r.jsx)(X,{initialSlab:h,initialCategories:f,onFormSubmitSuccess:()=>{e.push("/dashboard/slabs")}})})]})}},57773:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(57515),s=a(95155);let l=(0,r.A)((0,s.jsx)("path",{d:"m21.41 11.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58s1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41s-.23-1.06-.59-1.42M5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7"}),"LocalOffer")},68558:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(57515),s=a(95155);let l=(0,r.A)((0,s.jsx)("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"}),"Star")},82570:(e,t,a)=>{Promise.resolve().then(a.bind(a,52837))},88806:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var r=a(57515),s=a(95155);let l=(0,r.A)([(0,s.jsx)("path",{d:"m12 2-5.5 9h11z"},"0"),(0,s.jsx)("circle",{cx:"17.5",cy:"17.5",r:"4.5"},"1"),(0,s.jsx)("path",{d:"M3 13.5h8v8H3z"},"2")],"Category")}},e=>{var t=t=>e(e.s=t);e.O(0,[3627,1935,4127,5158,2842,9295,4801,8449,2110,6153,6874,2330,5297,9186,259,8441,1684,7358],()=>t(82570)),_N_E=e.O()}]);